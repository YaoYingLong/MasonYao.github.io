<!DOCTYPE html>
<html lang="en">
<head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="utf-8">
    
    <title>
        Linux磁盘与文件系统 |
        
        YingLong</title>
    
    
        <meta name="keywords" content="Linux">
    
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="description" content="Linux中每个装置都被当成一个文件，硬盘文件名为/dev/sd[a-p]，若使用的是云机，可能得到的是虚拟机，虚拟机内的磁盘是使用仿真器生成的磁盘文件名为/dev/vd[a-p]，软件磁盘阵列通常为/dev/md[0-128]的格式，LVM的磁盘通常为/dev/VGNAME/LVNAME；    装置 Linux内的文件名     SCSI/SATA/USB硬盘机 /dev/sd[a-p]">
<meta name="keywords" content="Linux">
<meta property="og:type" content="article">
<meta property="og:title" content="Linux磁盘与文件系统">
<meta property="og:url" content="https://yaoyinglong.github.io/Blog/杂记/Linux/Linux磁盘与文件系统/index.html">
<meta property="og:site_name" content="YingLong">
<meta property="og:description" content="Linux中每个装置都被当成一个文件，硬盘文件名为/dev/sd[a-p]，若使用的是云机，可能得到的是虚拟机，虚拟机内的磁盘是使用仿真器生成的磁盘文件名为/dev/vd[a-p]，软件磁盘阵列通常为/dev/md[0-128]的格式，LVM的磁盘通常为/dev/VGNAME/LVNAME；    装置 Linux内的文件名     SCSI/SATA/USB硬盘机 /dev/sd[a-p]">
<meta property="og:locale" content="en">
<meta property="og:image" content="https://yaoyinglong.github.io/images/操作系统/GPT分区表结构.png">
<meta property="og:image" content="https://yaoyinglong.github.io/images/Linux/block限制.png">
<meta property="og:image" content="https://yaoyinglong.github.io/images/Linux/硬链接示意图.png">
<meta property="og:image" content="https://yaoyinglong.github.io/images/Linux/跨文件系统不能硬链接.png">
<meta property="og:image" content="https://yaoyinglong.github.io/images/Linux/符号链接示意图.png">
<meta property="og:image" content="https://yaoyinglong.github.io/images/Linux/目录链接数据.png">
<meta property="og:updated_time" content="2024-03-04T13:15:25.735Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Linux磁盘与文件系统">
<meta name="twitter:description" content="Linux中每个装置都被当成一个文件，硬盘文件名为/dev/sd[a-p]，若使用的是云机，可能得到的是虚拟机，虚拟机内的磁盘是使用仿真器生成的磁盘文件名为/dev/vd[a-p]，软件磁盘阵列通常为/dev/md[0-128]的格式，LVM的磁盘通常为/dev/VGNAME/LVNAME；    装置 Linux内的文件名     SCSI/SATA/USB硬盘机 /dev/sd[a-p]">
<meta name="twitter:image" content="https://yaoyinglong.github.io/images/操作系统/GPT分区表结构.png">
    

    

    
        <link rel="icon" href="/favicon.ico">
    

    <link rel="stylesheet" href="/libs/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="/libs/open-sans/styles.css">
    <link rel="stylesheet" href="/libs/source-code-pro/styles.css">

    <link rel="stylesheet" href="/css/style.css">
    <script src="/libs/jquery/2.1.3/jquery.min.js"></script>
    <script src="/libs/jquery/plugins/cookie/1.4.1/jquery.cookie.js"></script>
    
    
        <link rel="stylesheet" href="/libs/lightgallery/css/lightgallery.min.css">
    
    
        <link rel="stylesheet" href="/libs/justified-gallery/justifiedGallery.min.css">
    
    
    
    


</head>
</html>
<body>
<div id="container">
    <header id="header">
    <div id="header-main" class="header-inner">
        <div class="outer">
            <a href="/" id="logo">
                <i class="logo"></i>
                <span class="site-title">YingLong</span>
            </a>
            <nav id="main-nav">
                
                    <a class="main-nav-link" href="/">Home</a>
                
                    <a class="main-nav-link" href="/archives">Archives</a>
                
                    <a class="main-nav-link" href="/categories">Categories</a>
                
                    <a class="main-nav-link" href="/tags">Tags</a>
                
                    <a class="main-nav-link" href="/about">About</a>
                
                <a class="main-nav-link" href="javascript:trigger()">Reading</a>
            </nav>
            
            <div id="search-form-wrap">
    
        <form class="search-form">
            <input type="text" class="ins-search-input search-form-input" placeholder="Search">
            <button type="submit" class="search-form-submit"></button>
        </form>
        <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="Type something...">
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
    (function (window) {
        var INSIGHT_CONFIG = {
            TRANSLATION: {
                POSTS: 'Posts',
                PAGES: 'Pages',
                CATEGORIES: 'Categories',
                TAGS: 'Tags',
                UNTITLED: '(Untitled)',
            },
            ROOT_URL: '/',
            CONTENT_URL: '/content.json',
        };
        window.INSIGHT_CONFIG = INSIGHT_CONFIG;
    })(window);
</script>
<script src="/js/insight.js"></script>
    
</div>
        </div>
    </div>
    <div id="main-nav-mobile" class="header-sub header-inner">
        <table class="menu outer">
            <tr>
                
                    <td><a class="main-nav-link" href="/">Home</a></td>
                
                    <td><a class="main-nav-link" href="/archives">Archives</a></td>
                
                    <td><a class="main-nav-link" href="/categories">Categories</a></td>
                
                    <td><a class="main-nav-link" href="/tags">Tags</a></td>
                
                    <td><a class="main-nav-link" href="/about">About</a></td>
                
                <td>
                    
    <div class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="Search">
    </div>

                </td>
            </tr>
        </table>
    </div>
</header>
<script type="text/javascript">
    var index = 0
    trigger = function () {
        if (index % 2 == 0) {
            $("#sidebar").css("display", "none");
            $("#main").css("float", "none");
        } else {
            $("#sidebar").css("display", "inline");
            $("#main").css("float", "left");
        }
        index++
    }
</script>

    <div class="outer">
        
        
            <aside id="sidebar">
    
        
    <div class="widget-wrap" id="categories">
        <h3 class="widget-title">
            <span>categories</span>
            &nbsp;
            <a id="allExpand" href="#">
                <i class="fa fa-angle-double-down fa-2x"></i>
            </a>
        </h3>

        
        
        
            <ul class="unstyled" id="tree">
                
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            Cloud
                        </a>
                        
            <ul class="unstyled" id="tree">
                
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            Dubbo
                        </a>
                        
            <ul class="unstyled" id="tree">
                
                    <li class="file"><a href="/Blog/Cloud/Dubbo/Dubbo基础/">Dubbo基础</a></li>
                
                    <li class="file"><a href="/Blog/Cloud/Dubbo/Dubbo服务调用/">Dubbo服务调用</a></li>
                
                    <li class="file"><a href="/Blog/Cloud/Dubbo/SPI机制源码/">SPI机制源码</a></li>
                
                    <li class="file"><a href="/Blog/Cloud/Dubbo/Dubbo服务引入/">Dubbo服务引入</a></li>
                
                    <li class="file"><a href="/Blog/Cloud/Dubbo/Dubbo服务导出/">Dubbo服务导出</a></li>
                
                    <li class="file"><a href="/Blog/Cloud/Dubbo/Dubbo与Spring集成原理/">Dubbo与Spring集成原理</a></li>
                
            </ul>
        
                    </li>
                
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            ELK
                        </a>
                        
            <ul class="unstyled" id="tree">
                
                    <li class="file"><a href="/Blog/Cloud/ELK/ElasticSearch基础/">ElasticSearch基础</a></li>
                
                    <li class="file"><a href="/Blog/Cloud/ELK/ElasticSearch实战/">ElasticSearch实战</a></li>
                
                    <li class="file"><a href="/Blog/Cloud/ELK/ElasticSearch进阶/">ElasticSearch进阶</a></li>
                
            </ul>
        
                    </li>
                
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            MQ
                        </a>
                        
            <ul class="unstyled" id="tree">
                
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            RocketMQ
                        </a>
                        
            <ul class="unstyled" id="tree">
                
                    <li class="file"><a href="/Blog/Cloud/MQ/RocketMQ/NameServer&Broker启动源码/">NameServer&Broker启动源码</a></li>
                
                    <li class="file"><a href="/Blog/Cloud/MQ/RocketMQ/RocketMQ高级特性/">RocketMQ高级特性</a></li>
                
                    <li class="file"><a href="/Blog/Cloud/MQ/RocketMQ/RocketMQ基础/">RocketMQ基础</a></li>
                
                    <li class="file"><a href="/Blog/Cloud/MQ/RocketMQ/RocketMQ消息存储源码/">RocketMQ消息存储源码</a></li>
                
                    <li class="file"><a href="/Blog/Cloud/MQ/RocketMQ/RocketMQ生产者源码/">RocketMQ生产者源码</a></li>
                
                    <li class="file"><a href="/Blog/Cloud/MQ/RocketMQ/RocketMQ消费者源码/">RocketMQ消费者源码</a></li>
                
                    <li class="file"><a href="/Blog/Cloud/MQ/RocketMQ/Consumer启动源码/">Consumer启动源码</a></li>
                
                    <li class="file"><a href="/Blog/Cloud/MQ/RocketMQ/Producer启动源码/">Producer启动源码</a></li>
                
            </ul>
        
                    </li>
                
                    <li class="file"><a href="/Blog/Cloud/MQ/Kafka基础/">Kafka基础</a></li>
                
                    <li class="file"><a href="/Blog/Cloud/MQ/RabbitMQ高级特性及Spring集成/">RabbitMQ高级特性及Spring集成</a></li>
                
                    <li class="file"><a href="/Blog/Cloud/MQ/RabbitMQ基础/">RabbitMQ基础</a></li>
                
            </ul>
        
                    </li>
                
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            Nacos
                        </a>
                        
            <ul class="unstyled" id="tree">
                
                    <li class="file"><a href="/Blog/Cloud/Nacos/Nacos Client原理/">Nacos Client原理</a></li>
                
                    <li class="file"><a href="/Blog/Cloud/Nacos/Nacos Server原理/">Nacos Server原理</a></li>
                
                    <li class="file"><a href="/Blog/Cloud/Nacos/Nacos问题总结/">Nacos问题总结</a></li>
                
                    <li class="file"><a href="/Blog/Cloud/Nacos/Nacos集群CP模式/">Nacos集群CP模式</a></li>
                
                    <li class="file"><a href="/Blog/Cloud/Nacos/Nacos配置中心Server原理/">Nacos配置中心Server原理</a></li>
                
                    <li class="file"><a href="/Blog/Cloud/Nacos/Nacos集群成员信息同步/">Nacos集群成员信息同步</a></li>
                
                    <li class="file"><a href="/Blog/Cloud/Nacos/Nacos集群注册服务同步/">Nacos集群注册服务同步</a></li>
                
                    <li class="file"><a href="/Blog/Cloud/Nacos/Nacos配置中心Client原理/">Nacos配置中心Client原理</a></li>
                
            </ul>
        
                    </li>
                
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            Netty
                        </a>
                        
            <ul class="unstyled" id="tree">
                
                    <li class="file"><a href="/Blog/Cloud/Netty/IO模型基础/">IO模型基础</a></li>
                
                    <li class="file"><a href="/Blog/Cloud/Netty/Netty基础/">Netty基础</a></li>
                
                    <li class="file"><a href="/Blog/Cloud/Netty/Netty源码/">Netty源码</a></li>
                
                    <li class="file"><a href="/Blog/Cloud/Netty/Netty进阶/">Netty进阶</a></li>
                
            </ul>
        
                    </li>
                
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            Redis
                        </a>
                        
            <ul class="unstyled" id="tree">
                
                    <li class="file"><a href="/Blog/Cloud/Redis/Redis分布式锁实现/">Redis分布式锁实现</a></li>
                
                    <li class="file"><a href="/Blog/Cloud/Redis/Redis缓存及性能优化/">Redis缓存及性能优化</a></li>
                
                    <li class="file"><a href="/Blog/Cloud/Redis/Redis基础/">Redis基础</a></li>
                
                    <li class="file"><a href="/Blog/Cloud/Redis/Redis集群架构/">Redis集群架构</a></li>
                
            </ul>
        
                    </li>
                
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            Seata
                        </a>
                        
            <ul class="unstyled" id="tree">
                
                    <li class="file"><a href="/Blog/Cloud/Seata/Seata集成原理/">Seata集成原理</a></li>
                
                    <li class="file"><a href="/Blog/Cloud/Seata/Seata分布式事务原理/">Seata分布式事务原理</a></li>
                
            </ul>
        
                    </li>
                
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            Sentinel
                        </a>
                        
            <ul class="unstyled" id="tree">
                
                    <li class="file"><a href="/Blog/Cloud/Sentinel/Sentinel配置持久化/">Sentinel配置持久化</a></li>
                
                    <li class="file"><a href="/Blog/Cloud/Sentinel/Sentinel规则发布源码/">Sentinel规则发布源码</a></li>
                
                    <li class="file"><a href="/Blog/Cloud/Sentinel/常见限流算法/">常见限流算法</a></li>
                
                    <li class="file"><a href="/Blog/Cloud/Sentinel/Sentinel限流熔断降级源码/">Sentinel限流熔断降级源码</a></li>
                
            </ul>
        
                    </li>
                
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            Zookeeper
                        </a>
                        
            <ul class="unstyled" id="tree">
                
                    <li class="file"><a href="/Blog/Cloud/Zookeeper/Zookeeper基础/">Zookeeper基础</a></li>
                
                    <li class="file"><a href="/Blog/Cloud/Zookeeper/Zookeeper客户端之ZAB/">Zookeeper客户端之ZAB</a></li>
                
                    <li class="file"><a href="/Blog/Cloud/Zookeeper/Zookeeper集群Leader选举/">Zookeeper集群Leader选举</a></li>
                
                    <li class="file"><a href="/Blog/Cloud/Zookeeper/Zookeeper服务端之ZAB/">Zookeeper服务端之ZAB</a></li>
                
            </ul>
        
                    </li>
                
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            网关
                        </a>
                        
            <ul class="unstyled" id="tree">
                
                    <li class="file"><a href="/Blog/Cloud/网关/Gateway源码/">Gateway源码</a></li>
                
            </ul>
        
                    </li>
                
                    <li class="file"><a href="/Blog/Cloud/Feign集成原理/">Feign集成原理</a></li>
                
                    <li class="file"><a href="/Blog/Cloud/Canal基础/">Canal基础</a></li>
                
                    <li class="file"><a href="/Blog/Cloud/Ribbon集成原理/">Ribbon集成原理</a></li>
                
                    <li class="file"><a href="/Blog/Cloud/分布式事务解决方案/">分布式事务解决方案</a></li>
                
                    <li class="file"><a href="/Blog/Cloud/分布式系统常见问题/">分布式系统常见问题</a></li>
                
                    <li class="file"><a href="/Blog/Cloud/秒杀问题及解决方案/">秒杀问题及解决方案</a></li>
                
            </ul>
        
                    </li>
                
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            DB
                        </a>
                        
            <ul class="unstyled" id="tree">
                
                    <li class="file"><a href="/Blog/DB/Explain工具/">Explain工具</a></li>
                
                    <li class="file"><a href="/Blog/DB/MongoDB基础/">MongoDB基础</a></li>
                
                    <li class="file"><a href="/Blog/DB/MVCC与BufferPool缓存机制/">MVCC与BufferPool缓存机制</a></li>
                
                    <li class="file"><a href="/Blog/DB/MySQL主从架构/">MySQL主从架构</a></li>
                
                    <li class="file"><a href="/Blog/DB/MySQL事务隔离级别与锁机制/">MySQL事务隔离级别与锁机制</a></li>
                
                    <li class="file"><a href="/Blog/DB/MySQL内部组件结构/">MySQL内部组件结构</a></li>
                
                    <li class="file"><a href="/Blog/DB/MySQL基础/">MySQL基础</a></li>
                
                    <li class="file"><a href="/Blog/DB/MySQL常用SQL总结/">MySQL常用SQL总结</a></li>
                
                    <li class="file"><a href="/Blog/DB/ShardingSphere基础/">ShardingSphere基础</a></li>
                
                    <li class="file"><a href="/Blog/DB/分库分表/">分库分表</a></li>
                
                    <li class="file"><a href="/Blog/DB/索引优化一/">索引优化一</a></li>
                
                    <li class="file"><a href="/Blog/DB/索引优化三/">索引优化三</a></li>
                
                    <li class="file"><a href="/Blog/DB/索引优化二/">索引优化二</a></li>
                
                    <li class="file"><a href="/Blog/DB/索引的原理与使用/">索引的原理与使用</a></li>
                
            </ul>
        
                    </li>
                
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            Java
                        </a>
                        
            <ul class="unstyled" id="tree">
                
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            VM
                        </a>
                        
            <ul class="unstyled" id="tree">
                
                    <li class="file"><a href="/Blog/Java/VM/JVM内存池/">JVM内存池</a></li>
                
                    <li class="file"><a href="/Blog/Java/VM/Minor&Major&Full GC/">Minor&Major&Full GC</a></li>
                
                    <li class="file"><a href="/Blog/Java/VM/Class文件结构/">Class文件结构</a></li>
                
                    <li class="file"><a href="/Blog/Java/VM/Java内存区域/">Java内存区域</a></li>
                
                    <li class="file"><a href="/Blog/Java/VM/OutOfMemoryError异常/">OOM异常实验</a></li>
                
                    <li class="file"><a href="/Blog/Java/VM/内存非配与回收策略/">内存分配与回收策略</a></li>
                
                    <li class="file"><a href="/Blog/Java/VM/垃圾收集器/">垃圾收集器</a></li>
                
                    <li class="file"><a href="/Blog/Java/VM/堆中对象分配&布局&访问/">堆中对象分配&布局&访问</a></li>
                
                    <li class="file"><a href="/Blog/Java/VM/垃圾收集算法/">垃圾收集算法及实现</a></li>
                
                    <li class="file"><a href="/Blog/Java/VM/字节码指令/">字节码指令</a></li>
                
                    <li class="file"><a href="/Blog/Java/VM/字节码指令手册/">字节码指令手册</a></li>
                
                    <li class="file"><a href="/Blog/Java/VM/对象是否存活/">对象是否存活</a></li>
                
                    <li class="file"><a href="/Blog/Java/VM/方法调用/">方法调用</a></li>
                
                    <li class="file"><a href="/Blog/Java/VM/属性表集合/">属性表集合</a></li>
                
                    <li class="file"><a href="/Blog/Java/VM/常量池/">常量池</a></li>
                
                    <li class="file"><a href="/Blog/Java/VM/理解GC日志/">理解GC日志</a></li>
                
                    <li class="file"><a href="/Blog/Java/VM/类加载器/">类加载器</a></li>
                
                    <li class="file"><a href="/Blog/Java/VM/运行时栈帧结构/">运行时栈帧结构</a></li>
                
                    <li class="file"><a href="/Blog/Java/VM/类加载过程/">类加载过程</a></li>
                
            </ul>
        
                    </li>
                
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            基础
                        </a>
                        
            <ul class="unstyled" id="tree">
                
                    <li class="file"><a href="/Blog/Java/基础/HashMap源码分析JDK8/">HashMap源码分析JDK8</a></li>
                
                    <li class="file"><a href="/Blog/Java/基础/Java实用工具库/">Java实用工具库</a></li>
                
                    <li class="file"><a href="/Blog/Java/基础/HashMap源码分析JDK7/">HashMap源码分析JDK7</a></li>
                
                    <li class="file"><a href="/Blog/Java/基础/lambda常用总结/">lambda常用总结</a></li>
                
                    <li class="file"><a href="/Blog/Java/基础/位运算/">位运算</a></li>
                
                    <li class="file"><a href="/Blog/Java/基础/PriorityQueue源码/">PriorityQueue源码</a></li>
                
                    <li class="file"><a href="/Blog/Java/基础/动态代理/">动态代理</a></li>
                
                    <li class="file"><a href="/Blog/Java/基础/反射基础/">反射基础</a></li>
                
                    <li class="file"><a href="/Blog/Java/基础/时间及日期总结/">Java8时间及日期</a></li>
                
                    <li class="file"><a href="/Blog/Java/基础/注解实现及应用/">注解实现及应用</a></li>
                
            </ul>
        
                    </li>
                
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            工具
                        </a>
                        
            <ul class="unstyled" id="tree">
                
                    <li class="file"><a href="/Blog/Java/工具/Java中调用Groovy脚本/">Java中调用Groovy脚本</a></li>
                
                    <li class="file"><a href="/Blog/Java/工具/JAVA实用工具/">JAVA实用工具</a></li>
                
                    <li class="file"><a href="/Blog/Java/工具/国密SM2/">国密SM2</a></li>
                
                    <li class="file"><a href="/Blog/Java/工具/国密SM4/">国密SM4</a></li>
                
            </ul>
        
                    </li>
                
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            并发
                        </a>
                        
            <ul class="unstyled" id="tree">
                
                    <li class="file"><a href="/Blog/Java/并发/BlockingQueue阻塞队列二/">BlockingQueue阻塞队列二</a></li>
                
                    <li class="file"><a href="/Blog/Java/并发/AQS与ReentrantLock/">AQS与ReentrantLock</a></li>
                
                    <li class="file"><a href="/Blog/Java/并发/Callable与Future/">Callable与Future</a></li>
                
                    <li class="file"><a href="/Blog/Java/并发/ConcurrentHashMap源码JDK7/">ConcurrentHashMap源码JDK7</a></li>
                
                    <li class="file"><a href="/Blog/Java/并发/Condition原理/">Condition原理</a></li>
                
                    <li class="file"><a href="/Blog/Java/并发/Java内存模型/">Java内存模型</a></li>
                
                    <li class="file"><a href="/Blog/Java/并发/ConcurrentHashMap源码JDK8/">ConcurrentHashMap源码JDK8</a></li>
                
                    <li class="file"><a href="/Blog/Java/并发/Java与线程/">Java与线程</a></li>
                
                    <li class="file"><a href="/Blog/Java/并发/BlockingQueue阻塞队列一/">BlockingQueue阻塞队列一</a></li>
                
                    <li class="file"><a href="/Blog/Java/并发/ReentrantReadWriteLock原理/">ReentrantReadWriteLock原理</a></li>
                
                    <li class="file"><a href="/Blog/Java/并发/ScheduledThreadPoolExecutor/">ScheduledThreadPoolExecutor</a></li>
                
                    <li class="file"><a href="/Blog/Java/并发/Synchronized总结/">Synchronized总结</a></li>
                
                    <li class="file"><a href="/Blog/Java/并发/ThreadLocal原理/">ThreadLocal原理</a></li>
                
                    <li class="file"><a href="/Blog/Java/并发/原子性、可见性、有序性/">原子性、可见性、有序性</a></li>
                
                    <li class="file"><a href="/Blog/Java/并发/Unsafe应用/">Unsafe应用</a></li>
                
                    <li class="file"><a href="/Blog/Java/并发/Volatile原理/">Volatile原理</a></li>
                
                    <li class="file"><a href="/Blog/Java/并发/线程安全/">线程安全</a></li>
                
                    <li class="file"><a href="/Blog/Java/并发/线程安全实现方式/">线程安全实现方式</a></li>
                
                    <li class="file"><a href="/Blog/Java/并发/同步工具类/">同步工具类</a></li>
                
                    <li class="file"><a href="/Blog/Java/并发/锁优化/">锁优化</a></li>
                
                    <li class="file"><a href="/Blog/Java/并发/线程池原理/">线程池原理</a></li>
                
                    <li class="file"><a href="/Blog/Java/并发/操作系统底层/">操作系统底层</a></li>
                
            </ul>
        
                    </li>
                
                    <li class="file"><a href="/Blog/Java/JVM内存参数设置/">JVM内存参数设置</a></li>
                
                    <li class="file"><a href="/Blog/Java/JVM调优工具/">JVM调优工具</a></li>
                
                    <li class="file"><a href="/Blog/Java/JVM整体概览/">JVM整体概览</a></li>
                
                    <li class="file"><a href="/Blog/Java/JVM调优思路/">JVM调优思路</a></li>
                
            </ul>
        
                    </li>
                
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            Maven
                        </a>
                        
            <ul class="unstyled" id="tree">
                
                    <li class="file"><a href="/Blog/Maven/Maven仓库/">Maven仓库</a></li>
                
                    <li class="file"><a href="/Blog/Maven/Maven Assembly标签全解/">Maven Assembly标签全解</a></li>
                
                    <li class="file"><a href="/Blog/Maven/Maven基础/">Maven基础</a></li>
                
                    <li class="file"><a href="/Blog/Maven/Maven加密JAR包/">Maven加密JAR包</a></li>
                
                    <li class="file"><a href="/Blog/Maven/Maven个性化打包/">Maven个性化打包</a></li>
                
                    <li class="file"><a href="/Blog/Maven/Maven属性/">Maven属性</a></li>
                
                    <li class="file"><a href="/Blog/Maven/Maven常用/">Maven常用</a></li>
                
                    <li class="file"><a href="/Blog/Maven/Maven常用工具/">Maven常用工具</a></li>
                
                    <li class="file"><a href="/Blog/Maven/Maven常见问题总结/">Maven常见问题总结</a></li>
                
                    <li class="file"><a href="/Blog/Maven/Maven常用插件/">Maven常用插件</a></li>
                
                    <li class="file"><a href="/Blog/Maven/Maven插件基础/">Maven插件基础</a></li>
                
                    <li class="file"><a href="/Blog/Maven/Maven插件编写/">Maven插件编写</a></li>
                
                    <li class="file"><a href="/Blog/Maven/Maven标签全解/">Maven标签全解</a></li>
                
                    <li class="file"><a href="/Blog/Maven/Maven生命周期/">Maven生命周期</a></li>
                
                    <li class="file"><a href="/Blog/Maven/Maven聚合与继承/">Maven聚合与继承</a></li>
                
            </ul>
        
                    </li>
                
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            Spring
                        </a>
                        
            <ul class="unstyled" id="tree">
                
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            SpringBoot
                        </a>
                        
            <ul class="unstyled" id="tree">
                
                    <li class="file"><a href="/Blog/Spring/SpringBoot/SpringBoot Jar包启动原理/">SpringBoot Jar包启动原理</a></li>
                
                    <li class="file"><a href="/Blog/Spring/SpringBoot/SpringBoot资源加载/">SpringBoot资源加载</a></li>
                
                    <li class="file"><a href="/Blog/Spring/SpringBoot/SpringBoot自动装配原理/">SpringBoot自动装配原理</a></li>
                
                    <li class="file"><a href="/Blog/Spring/SpringBoot/SpringBoot启动原理/">SpringBoot启动原理</a></li>
                
            </ul>
        
                    </li>
                
                    <li class="file"><a href="/Blog/Spring/AOP切面类解析/">AOP切面类解析</a></li>
                
                    <li class="file"><a href="/Blog/Spring/AOP创建代理与调用/">AOP创建代理与调用</a></li>
                
                    <li class="file"><a href="/Blog/Spring/BeanDefinition解析注册/">BeanDefinition解析注册</a></li>
                
                    <li class="file"><a href="/Blog/Spring/Bean的生命周期/">Bean的生命周期</a></li>
                
                    <li class="file"><a href="/Blog/Spring/Hystrix总结/">Hystrix总结</a></li>
                
                    <li class="file"><a href="/Blog/Spring/Bean的加载过程/">Bean的加载过程</a></li>
                
                    <li class="file"><a href="/Blog/Spring/IoC容器/">IoC容器</a></li>
                
                    <li class="file"><a href="/Blog/Spring/Spring Gzip压缩/">Spring Gzip压缩</a></li>
                
                    <li class="file"><a href="/Blog/Spring/IoC容器加载过程/">IoC容器加载过程</a></li>
                
                    <li class="file"><a href="/Blog/Spring/SpringMvc异步/">SpringMvc异步原理及实现</a></li>
                
                    <li class="file"><a href="/Blog/Spring/SpringMvc加载机制/">SpringMvc加载机制</a></li>
                
                    <li class="file"><a href="/Blog/Spring/Spring初始化扩展/">Spring扩展点</a></li>
                
                    <li class="file"><a href="/Blog/Spring/Spring整体架构/">Spring整体架构</a></li>
                
                    <li class="file"><a href="/Blog/Spring/SpringMvc处理分发请求原理/">SpringMvc处理分发请求原理</a></li>
                
                    <li class="file"><a href="/Blog/Spring/Spring线程池跨线程数据共享/">Spring线程池跨线程数据共享</a></li>
                
                    <li class="file"><a href="/Blog/Spring/事件监听器/">事件监听器</a></li>
                
                    <li class="file"><a href="/Blog/Spring/事务解析原理/">事务解析原理</a></li>
                
                    <li class="file"><a href="/Blog/Spring/事务调用原理/">事务调用原理</a></li>
                
            </ul>
        
                    </li>
                
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            Test
                        </a>
                        
            <ul class="unstyled" id="tree">
                
                    <li class="file"><a href="/Blog/Test/IT测试总结/">IT测试总结</a></li>
                
                    <li class="file"><a href="/Blog/Test/UT测试总结/">UT测试总结</a></li>
                
                    <li class="file"><a href="/Blog/Test/JMeter日常总结/">JMeter日常总结</a></li>
                
                    <li class="file"><a href="/Blog/Test/LoadRunner日常总结/">LoadRunner日常总结</a></li>
                
            </ul>
        
                    </li>
                
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            中间件
                        </a>
                        
            <ul class="unstyled" id="tree">
                
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            Mybatis
                        </a>
                        
            <ul class="unstyled" id="tree">
                
                    <li class="file"><a href="/Blog/中间件/Mybatis/Mybatis缓存原理/">Mybatis缓存原理</a></li>
                
                    <li class="file"><a href="/Blog/中间件/Mybatis/Mybatis执行SQL原理/">Mybatis执行SQL原理</a></li>
                
                    <li class="file"><a href="/Blog/中间件/Mybatis/Mybatis集成到Spring原理/">Mybatis集成到Spring原理</a></li>
                
                    <li class="file"><a href="/Blog/中间件/Mybatis/Mybatis配置文件解析原理/">Mybatis配置文件解析原理</a></li>
                
            </ul>
        
                    </li>
                
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            Tomcat
                        </a>
                        
            <ul class="unstyled" id="tree">
                
                    <li class="file"><a href="/Blog/中间件/Tomcat/BIO和NIO底层原理对比/">BIO和NIO底层原理对比</a></li>
                
                    <li class="file"><a href="/Blog/中间件/Tomcat/Tomcat处理响应过程/">Tomcat处理响应过程</a></li>
                
                    <li class="file"><a href="/Blog/中间件/Tomcat/Tomcat启动过程/">Tomcat启动过程</a></li>
                
                    <li class="file"><a href="/Blog/中间件/Tomcat/Tomcat处理请求过程/">Tomcat处理请求过程</a></li>
                
                    <li class="file"><a href="/Blog/中间件/Tomcat/Tomcat工作原理/">Tomcat工作原理</a></li>
                
                    <li class="file"><a href="/Blog/中间件/Tomcat/Tomcat热部署热加载/">Tomcat热部署热加载</a></li>
                
                    <li class="file"><a href="/Blog/中间件/Tomcat/Tomcat整体架构/">Tomcat整体架构</a></li>
                
            </ul>
        
                    </li>
                
            </ul>
        
                    </li>
                
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            云原生
                        </a>
                        
            <ul class="unstyled" id="tree">
                
                    <li class="file"><a href="/Blog/云原生/Docker基础/">Docker基础</a></li>
                
                    <li class="file"><a href="/Blog/云原生/Docker Compose基础/">Docker Compose基础</a></li>
                
                    <li class="file"><a href="/Blog/云原生/Docker搭建Prometheus&Grafana/">Docker搭建Prometheus&Grafana</a></li>
                
                    <li class="file"><a href="/Blog/云原生/Kubernetes基础/">Kubernetes基础</a></li>
                
            </ul>
        
                    </li>
                
                    <li class="directory open">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder-open"></i>
                            &nbsp;
                            杂记
                        </a>
                        
            <ul class="unstyled" id="tree">
                
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            Git
                        </a>
                        
            <ul class="unstyled" id="tree">
                
                    <li class="file"><a href="/Blog/杂记/Git/GIt基本概念/">Git基本概念</a></li>
                
                    <li class="file"><a href="/Blog/杂记/Git/GIt常用命令/">Git常用命令</a></li>
                
                    <li class="file"><a href="/Blog/杂记/Git/分支管理理解/">分支管理理解</a></li>
                
            </ul>
        
                    </li>
                
                    <li class="directory open">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder-open"></i>
                            &nbsp;
                            Linux
                        </a>
                        
            <ul class="unstyled" id="tree">
                
                    <li class="file"><a href="/Blog/杂记/Linux/Linux常用命令/">Linux常用命令</a></li>
                
                    <li class="file"><a href="/Blog/杂记/Linux/Linux基础/">Linux基础</a></li>
                
                    <li class="file"><a href="/Blog/杂记/Linux/Shell基础/">Shell基础</a></li>
                
                    <li class="file active"><a href="/Blog/杂记/Linux/Linux磁盘与文件系统/">Linux磁盘与文件系统</a></li>
                
                    <li class="file"><a href="/Blog/杂记/Linux/零拷贝技术/">零拷贝技术</a></li>
                
                    <li class="file"><a href="/Blog/杂记/Linux/Linux非常用命令/">Linux非常用命令</a></li>
                
                    <li class="file"><a href="/Blog/杂记/Linux/文件&文件系统压缩打包备份/">Linux压缩打包备份</a></li>
                
                    <li class="file"><a href="/Blog/杂记/Linux/Vim编辑器/">Vim编辑器</a></li>
                
                    <li class="file"><a href="/Blog/杂记/Linux/Bash和Shell/">Bash与Shell</a></li>
                
            </ul>
        
                    </li>
                
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            协议族
                        </a>
                        
            <ul class="unstyled" id="tree">
                
                    <li class="file"><a href="/Blog/杂记/协议族/TCPIP四层&五层模型/">TCP/IP四层&五层模型</a></li>
                
                    <li class="file"><a href="/Blog/杂记/协议族/以太网/">以太网</a></li>
                
                    <li class="file"><a href="/Blog/杂记/协议族/网络基础知识/">网络基础知识</a></li>
                
                    <li class="file"><a href="/Blog/杂记/协议族/地址解析协议/">地址解析协议ARP</a></li>
                
                    <li class="file"><a href="/Blog/杂记/协议族/TCP&UDP协议/">TCP&UDP协议</a></li>
                
                    <li class="file"><a href="/Blog/杂记/协议族/HTTP协议/">HTTP协议</a></li>
                
                    <li class="file"><a href="/Blog/杂记/协议族/HTTPs协议/">HTTPs协议</a></li>
                
            </ul>
        
                    </li>
                
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            工具
                        </a>
                        
            <ul class="unstyled" id="tree">
                
                    <li class="file"><a href="/Blog/杂记/工具/SonarQube配置总结/">SonarQube配置总结</a></li>
                
                    <li class="file"><a href="/Blog/杂记/工具/IDEA快捷的使用/">IDEA的快捷使用</a></li>
                
                    <li class="file"><a href="/Blog/杂记/工具/Win实用工具/">Win实用工具</a></li>
                
                    <li class="file"><a href="/Blog/杂记/工具/XSD使用总结/">XSD实用总结</a></li>
                
            </ul>
        
                    </li>
                
            </ul>
        
                    </li>
                
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            算法
                        </a>
                        
            <ul class="unstyled" id="tree">
                
                    <li class="file"><a href="/Blog/算法/二叉搜索树/">二叉搜索树</a></li>
                
                    <li class="file"><a href="/Blog/算法/图基础/">图基础</a></li>
                
                    <li class="file"><a href="/Blog/算法/基础算法/">基础算法</a></li>
                
                    <li class="file"><a href="/Blog/算法/平衡二叉树/">平衡二叉树</a></li>
                
                    <li class="file"><a href="/Blog/算法/排序算法/">排序算法</a></li>
                
                    <li class="file"><a href="/Blog/算法/树基础/">树基础</a></li>
                
                    <li class="file"><a href="/Blog/算法/经典算法-动态规划/">经典算法-动态规划</a></li>
                
                    <li class="file"><a href="/Blog/算法/经典算法-栈/">经典算法-栈</a></li>
                
                    <li class="file"><a href="/Blog/算法/经典算法-链表/">经典算法-链表</a></li>
                
                    <li class="file"><a href="/Blog/算法/经典算法/">经典算法</a></li>
                
                    <li class="file"><a href="/Blog/算法/经典算法-数组/">经典算法-数组</a></li>
                
            </ul>
        
                    </li>
                
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            设计模式
                        </a>
                        
            <ul class="unstyled" id="tree">
                
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            创建型模式
                        </a>
                        
            <ul class="unstyled" id="tree">
                
                    <li class="file"><a href="/Blog/设计模式/创建型模式/单例模式/">单例模式</a></li>
                
                    <li class="file"><a href="/Blog/设计模式/创建型模式/原型模式/">原型模式</a></li>
                
                    <li class="file"><a href="/Blog/设计模式/创建型模式/工厂模式/">工厂模式</a></li>
                
                    <li class="file"><a href="/Blog/设计模式/创建型模式/建造者模式/">建造者模式</a></li>
                
            </ul>
        
                    </li>
                
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            结构型模式
                        </a>
                        
            <ul class="unstyled" id="tree">
                
                    <li class="file"><a href="/Blog/设计模式/结构型模式/外观模式/">外观模式</a></li>
                
                    <li class="file"><a href="/Blog/设计模式/结构型模式/代理模式/">代理模式</a></li>
                
                    <li class="file"><a href="/Blog/设计模式/结构型模式/组合模式/">组合模式</a></li>
                
                    <li class="file"><a href="/Blog/设计模式/结构型模式/装饰模式/">装饰模式</a></li>
                
                    <li class="file"><a href="/Blog/设计模式/结构型模式/适配器模式/">适配器模式</a></li>
                
                    <li class="file"><a href="/Blog/设计模式/结构型模式/享元模式/">享元模式</a></li>
                
                    <li class="file"><a href="/Blog/设计模式/结构型模式/桥梁模式/">桥梁模式</a></li>
                
            </ul>
        
                    </li>
                
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            行为型模式
                        </a>
                        
            <ul class="unstyled" id="tree">
                
                    <li class="file"><a href="/Blog/设计模式/行为型模式/命令模式/">命令模式</a></li>
                
                    <li class="file"><a href="/Blog/设计模式/行为型模式/备忘录模式/">备忘录模式</a></li>
                
                    <li class="file"><a href="/Blog/设计模式/行为型模式/模板方法模式/">模板方法模式</a></li>
                
                    <li class="file"><a href="/Blog/设计模式/行为型模式/状态模式/">状态模式</a></li>
                
                    <li class="file"><a href="/Blog/设计模式/行为型模式/中介者模式/">中介者模式</a></li>
                
                    <li class="file"><a href="/Blog/设计模式/行为型模式/策略模式/">策略模式</a></li>
                
                    <li class="file"><a href="/Blog/设计模式/行为型模式/观察者模式/">观察者模式</a></li>
                
                    <li class="file"><a href="/Blog/设计模式/行为型模式/责任链模式/">责任链模式</a></li>
                
                    <li class="file"><a href="/Blog/设计模式/行为型模式/迭代器模式/">迭代器模式</a></li>
                
                    <li class="file"><a href="/Blog/设计模式/行为型模式/访问者模式/">访问者模式</a></li>
                
                    <li class="file"><a href="/Blog/设计模式/行为型模式/解释器模式/">解释器模式</a></li>
                
            </ul>
        
                    </li>
                
                    <li class="file"><a href="/Blog/设计模式/SOLID基本原则/">SOLID基本原则</a></li>
                
                    <li class="file"><a href="/Blog/设计模式/设计模式概览/">设计模式概览</a></li>
                
                    <li class="file"><a href="/Blog/设计模式/设计模式对比/">设计模式对比</a></li>
                
            </ul>
        
                    </li>
                
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            语言
                        </a>
                        
            <ul class="unstyled" id="tree">
                
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            CPP
                        </a>
                        
            <ul class="unstyled" id="tree">
                
                    <li class="file"><a href="/Blog/语言/CPP/IO流/">IO流</a></li>
                
                    <li class="file"><a href="/Blog/语言/CPP/CPP基础/">CPP基础</a></li>
                
            </ul>
        
                    </li>
                
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            Go
                        </a>
                        
            <ul class="unstyled" id="tree">
                
                    <li class="file"><a href="/Blog/语言/Go/Go基础/">Go基础</a></li>
                
            </ul>
        
                    </li>
                
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            Python
                        </a>
                        
            <ul class="unstyled" id="tree">
                
                    <li class="file"><a href="/Blog/语言/Python/Excel文件数据抽取/">Excel文件数据抽取</a></li>
                
            </ul>
        
                    </li>
                
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            前端
                        </a>
                        
            <ul class="unstyled" id="tree">
                
                    <li class="file"><a href="/Blog/语言/前端/JavaScript基础/">JavaScript基础</a></li>
                
                    <li class="file"><a href="/Blog/语言/前端/TypeScript基础/">TypeScript基础</a></li>
                
            </ul>
        
                    </li>
                
            </ul>
        
                    </li>
                
                    <li class="file"><a href="/Blog/index/"></a></li>
                
            </ul>
        
    </div>
    <script>
        $(document).ready(function () {
            var iconFolderOpenClass = 'fa-folder-open';
            var iconFolderCloseClass = 'fa-folder';
            var iconAllExpandClass = 'fa-angle-double-down';
            var iconAllPackClass = 'fa-angle-double-up';
            // Handle directory-tree expansion:
            // 左键单独展开目录
            $(document).on('click', '#categories a[data-role="directory"]', function (event) {
                event.preventDefault();

                var icon = $(this).children('.fa');
                var expanded = icon.hasClass(iconFolderOpenClass);
                var subtree = $(this).siblings('ul');
                icon.removeClass(iconFolderOpenClass).removeClass(iconFolderCloseClass);
                if (expanded) {
                    if (typeof subtree != 'undefined') {
                        subtree.slideUp({duration: 100});
                    }
                    icon.addClass(iconFolderCloseClass);
                } else {
                    if (typeof subtree != 'undefined') {
                        subtree.slideDown({duration: 100});
                    }
                    icon.addClass(iconFolderOpenClass);
                }
            });
            // 右键展开下属所有目录
            $('#categories a[data-role="directory"]').bind("contextmenu", function (event) {
                event.preventDefault();

                var icon = $(this).children('.fa');
                var expanded = icon.hasClass(iconFolderOpenClass);
                var listNode = $(this).siblings('ul');
                var subtrees = $.merge(listNode.find('li ul'), listNode);
                var icons = $.merge(listNode.find('.fa'), icon);
                icons.removeClass(iconFolderOpenClass).removeClass(iconFolderCloseClass);
                if (expanded) {
                    subtrees.slideUp({duration: 100});
                    icons.addClass(iconFolderCloseClass);
                } else {
                    subtrees.slideDown({duration: 100});
                    icons.addClass(iconFolderOpenClass);
                }
            })
            // 展开关闭所有目录按钮
            $(document).on('click', '#allExpand', function (event) {
                event.preventDefault();

                var icon = $(this).children('.fa');
                var expanded = icon.hasClass(iconAllExpandClass);
                icon.removeClass(iconAllExpandClass).removeClass(iconAllPackClass);
                if (expanded) {
                    $('#sidebar .fa.fa-folder').removeClass('fa-folder').addClass('fa-folder-open')
                    $('#categories li ul').slideDown({duration: 100});
                    icon.addClass(iconAllPackClass);
                } else {
                    $('#sidebar .fa.fa-folder-open').removeClass('fa-folder-open').addClass('fa-folder')
                    $('#categories li ul').slideUp({duration: 100});
                    icon.addClass(iconAllExpandClass);
                }
            });
        });
    </script>

    
</aside>
<div id="toTop" class="fa fa-angle-up"></div>

        
        <section id="main"><article id="post-杂记/Linux/Linux磁盘与文件系统" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
                    <div class="article-meta">
                        
    <div class="article-category">
        <i class="fa fa-folder"></i>
        <a class="article-category-link" href="/categories/杂记/">杂记</a><i class="fa fa-angle-right"></i><a class="article-category-link" href="/categories/杂记/Linux/">Linux</a>
    </div>

                        
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link" href="/tags/Linux/">Linux</a>
    </div>

                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/Blog/杂记/Linux/Linux磁盘与文件系统/">
            <time datetime="2018-01-17T16:00:00.000Z" itemprop="datePublished">2018-01-18</time>
        </a>
    </div>


                        
                    </div>
                
                
    
        <h1 class="article-title" itemprop="name">
            Linux磁盘与文件系统
        </h1>
    

            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
            
            
                    
            
            
                <p>Linux中<strong>每个装置</strong>都被当成一个<strong>文件</strong>，硬盘文件名为<strong><code>/dev/sd[a-p]</code></strong>，若使用的是云机，可能得到的是虚拟机，<strong>虚拟机</strong>内的磁盘是使用<strong>仿真器</strong>生成的磁盘文件名为<strong><code>/dev/vd[a-p]</code></strong>，软件磁盘阵列通常为<strong><code>/dev/md[0-128]</code></strong>的格式，<strong><code>LVM</code></strong>的磁盘通常为<strong><code>/dev/VGNAME/LVNAME</code></strong>；</p>
<table>
<thead>
<tr>
<th>装置</th>
<th>Linux内的文件名</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong><code>SCSI/SATA/USB</code></strong>硬盘机</td>
<td><strong><code>/dev/sd[a-p]</code></strong></td>
</tr>
<tr>
<td>USB快闪碟</td>
<td><strong><code>/dev/sd[a-p]</code></strong>（与SATA相同）</td>
</tr>
<tr>
<td>Virt I/O界面</td>
<td><strong><code>/dev/vd[a-p]</code></strong>（用于虚拟机内）</td>
</tr>
<tr>
<td>软盘驱动器</td>
<td><strong><code>/dev/fd[0-7]</code></strong></td>
</tr>
<tr>
<td>打印机</td>
<td><strong><code>/dev/input/mouse[0-15]</code></strong>（通用）<br><strong><code>/dev/psaux</code></strong>（PS/2界面）<br><strong><code>/dev/mouse</code></strong>当前鼠标</td>
</tr>
<tr>
<td>CDROM/DVDROM</td>
<td><strong><code>/dev/scd[0-1]</code></strong>（通用）<br><strong><code>/dev/sr[0-1]</code></strong>（通用）<br><strong><code>/dev/cdrom</code></strong>当前CDROM</td>
</tr>
<tr>
<td>磁带机</td>
<td><strong><code>/dev/ht0</code></strong>（IDE界面）<br><strong><code>/dev/st0</code></strong>（SATA/SCSI界面）<br><strong><code>/dev/tape</code></strong>当前磁带</td>
</tr>
<tr>
<td>IDE硬盘机</td>
<td><strong><code>/dev/hd[a-d]</code></strong>(旧系统才有)，会被仿真成<strong><code>/dev/sd[a-p]</code></strong></td>
</tr>
</tbody>
</table>
<p><strong><code>SATA/USB/SAS</code></strong>等磁盘接口都是使用<strong>SCSI模块</strong>来驱动的，故这些接口的磁盘装置文件名都是<strong><code>/dev/sd[a-p]</code></strong>的格式，<strong><code>SATA/USB</code></strong>接口的磁盘是没有顺序的，其装置文件名是根据Linux核心侦测到的。如一个PC主板上有六个SATA插槽，两个SATA分别位于SATA1和SATA5，以及一个USB，此时SATA1上的装置文件名为<strong><code>/dev/sda</code></strong>，SATA2上的装置文件名为<strong><code>/dev/sdb</code></strong>，USB磁盘在开机完成后才会被系统捕捉到装置名为<strong><code>/dev/sdc</code></strong>。</p>
<h3 id="MSDOS与GPT"><a href="#MSDOS与GPT" class="headerlink" title="MSDOS与GPT"></a>MSDOS与GPT</h3><p><strong>磁盘的组成</strong>：<strong>磁盘盘</strong>、<strong>机械手臂</strong>、<strong>磁盘读取头</strong>、<strong>主轴马达</strong>，数据写入是在磁盘盘面上，<strong>磁盘盘面</strong>又分为<strong>扇区</strong>和<strong>磁道</strong>，所有<strong>磁盘的同一个磁道</strong>称为<strong>磁柱<code>Cylinder</code></strong>，<strong>扇区</strong>是最小的物理存储单位，其的物理设计大小有<strong><code>512bytes</code></strong>和<strong><code>4Kbytes</code></strong>两种。</p>
<p>整个磁盘的<strong>第一扇区特别重要</strong>，其<strong>记录了整个磁盘的重要信息</strong>，早期磁盘第一个扇区中含有重要信息故被称为<strong><code>MBR</code></strong>即<strong><code>Master Boot Record</code>格式</strong>即<strong>主要开机记录区</strong>也叫<strong><code>MSDOS</code></strong>；<strong>由于磁盘容量不断扩大</strong>从而产生了新的磁盘分区格式<strong><code>GPT</code></strong>即<strong><code>GUID partition table</code></strong>，其分区数量扩充较多，磁盘容量也可以超过<strong><code>2TB</code></strong>；</p>
<p>由于<strong>每种操作系统所设定的文件属性/权限并不相同</strong>，为了存放这些文件所需的数据，<strong>磁盘分区完毕后</strong>还需要<strong>进行格式化之后</strong>操作系统才能够使用这个文件系统；<strong><code>windows 98</code></strong>以前的微软操作系统主要使用<strong><code>FAT</code></strong>或<strong><code>FAT16</code></strong>文件系统，<strong><code>windows 2000</code></strong>以后的版本有所谓的<strong><code>NTFS</code></strong>文件系统，Linux的正统文件系统则为<strong><code>Ext2</code></strong>即<strong><code>Linux second extended file system</code></strong>即<strong><code>ext2fs</code></strong>；</p>
<p><strong>传统磁盘与文件系统</strong>一个分区槽就是只能够被格式化成为一个文件系统，可以说<strong>一个文件系统就是一个分区槽</strong>；但LVM与软件磁盘阵列可将一个分区槽格式化为多个文件系统，也能将多个分区合并成一个文件系统，故称呼<strong>一个可被挂载的数据为一个文件系统</strong>而不是一个分区槽；</p>
<h5 id="MBR"><a href="#MBR" class="headerlink" title="MBR"></a>MBR</h5><p>早期Linux为了兼容Windows磁盘，因此使用的是支持Windows的<strong><code>MBR</code>主要开机记录区</strong>的方式来处理<strong>开机管理程序</strong>与<strong>分区表</strong>，而<strong><code>MBR</code>主要开机记录区</strong>和<strong>分区表</strong>都放在磁盘的<strong>第一个扇区</strong>，该扇区通常是<strong><code>512bytes</code></strong>，<strong>旧磁盘扇区</strong>都是<strong><code>512bytes</code></strong>：</p>
<ul>
<li><strong><code>MBR</code>主要开机记录区，<code>Master Boot Record</code></strong>：<strong><code>446bytes</code></strong>，可<strong>安装开机管理程序</strong></li>
<li><strong><code>partition table</code>分区表</strong>：<strong><code>64bytes</code></strong>，记录整个硬盘<strong>分区的状态</strong></li>
</ul>
<p>由于<strong>分区表</strong>所在区块只有<strong><code>64bytes</code></strong>容量，最多仅能存储<strong>四组记录区</strong>，每组记录区记录了<strong>该区段的起始</strong>与<strong>结束</strong>的<strong>磁柱号码</strong>，且<strong>四组记录区</strong>被称为<strong><code>Primary</code>主要分区槽</strong>或<strong><code>Extended</code>延伸分区槽</strong>：</p>
<ul>
<li>所谓分区只是针对该<strong><code>64bytes</code>分区表</strong>进行的设定</li>
<li><strong>磁盘默认的分区表</strong>仅能写入<strong>四组</strong>分区信息</li>
<li><strong>分区槽</strong>的<strong>最小单位</strong>通常为<strong>磁柱</strong></li>
<li>当系统要写入磁盘时，一定会参考磁盘分区表，才能针对某个分区槽进行数据的处理</li>
</ul>
<p>之所以要分区是出于<strong>安全考虑</strong>，当对某个分区槽的数据重整时，不会影响到其他分区槽的数据，是数据更安全，<strong>系统效能考虑</strong>，当读取数据时，只会读取某个分区槽的指定磁柱范围，有助于数据读取速度与效能。</p>
<p>最多仅能存储<strong>四组记录区</strong>，并不代表最多只能分区出四个分区槽，可<strong>利用延伸分区</strong>来记录更多的分区信息，从而来将磁盘分出更多分区，<strong>实际上延伸分区并不是只占一个分区，而是会分布在每个分区槽的最前面几个扇区来记载分区信息</strong>。延伸分区的目的是使用额外的扇区来记录分区信息，<strong>延伸分区本身并不能被拿来格式化</strong>，可以通过<strong>延伸分区</strong>所指向的那个区块继续做分区的记录。由延伸分区继续分区出来的分区槽被称为<strong>逻辑分区槽</strong>，且逻辑分区槽的<strong>装置名称号码</strong>是<strong>由5开始</strong>。</p>
<p><strong>分区</strong>是<strong>以磁柱为单位</strong>的<strong>连续磁盘空间</strong>，且延伸分区又类似独立的磁盘空间，若<strong>延伸分区被破坏所有逻辑分区将会被删除</strong>，这是因为<strong>逻辑分区的信息都记录在延伸分区中</strong>，MBR主要分区、延伸分区与逻辑分区的特性：</p>
<ul>
<li>由于MBR<strong>硬盘的限制</strong>，<strong>主要分区</strong>与<strong>延伸分区</strong>加起来最多只能有<strong><code>4</code>组</strong></li>
<li>由于操作系统限制，<strong>延伸分区</strong>最多只能有<strong>一个</strong></li>
<li><strong>逻辑分区</strong>是由<strong>延伸分区</strong>持续<strong>切割</strong>出来的<strong>分区槽</strong></li>
<li><strong>延伸分区无法格式化</strong>，作为数据存取的<strong>主要分区</strong>与<strong>逻辑分区</strong>才能被格式化</li>
<li>逻辑分区的数量依操作系统而不同，Linux中<strong><code>SATA</code></strong>硬盘已经可以突破<strong><code>63</code></strong>个以上的分区限制</li>
</ul>
<p>由于<strong>第一个扇区</strong>所记录的<strong>分区表</strong>与<strong><code>MBR</code></strong>特别重要，几乎<strong>只要读取硬盘都会先由这个扇区先读起</strong>，若硬盘第一个扇区物理实体损坏，由于系统找不到分区表，不知道如何读取磁柱区间 ，则整个硬盘就损坏了。</p>
<p>若将系统分成四个主要分区，即使硬盘还有剩余空间也无法再继续分区，故若分区超过四个一定要有延伸分区，必须将所有剩余空间都分配给<strong>延伸分区</strong>，然后再以<strong>逻辑分区</strong>来规划<strong>延伸空间</strong>，考虑到磁盘的连续性，一般建议将<strong>延伸分区的磁柱号码</strong>分配在<strong>最后面的磁柱内</strong>。</p>
<p>MBR分区表除了主分区、延伸分区、逻辑分区需要注意之外，由于每组分区表仅有<strong><code>16bytes</code></strong>，记录的信息相当有限，在过去MBR分区表的限制中经常可以发现如下的问题：</p>
<ul>
<li>操作系统<strong>无法抓取到<code>2.2T</code>以上的磁盘容量</strong></li>
<li>MBR仅有一个区块，若被破坏后，经常无法或很难救援</li>
<li>MBR内存放<strong>开机管理程序</strong>的区块仅<strong><code>446bytes</code></strong>，<strong>无法容纳较多的程序代码</strong></li>
</ul>
<h5 id="GPT"><a href="#GPT" class="headerlink" title="GPT"></a>GPT</h5><p>过去一个扇区大小是<strong><code>512bytes</code></strong>，目前已有<strong><code>4K</code></strong>扇区，为了兼容于所有磁盘，在扇区定义中大多会使用<strong><code>Logical Block Address</code>逻辑区块地址<code>LBA</code></strong>来处理，<strong><code>GPT</code></strong>将磁盘所有区块以<strong>预设为<code>512bytes</code>的<code>LBA</code>来规划</strong>，第一个<strong><code>LBA</code></strong>称为<strong><code>LBA0</code></strong>。</p>
<p><img src="../../../../../images/操作系统/GPT分区表结构.png" alt></p>
<p>相比于<strong><code>MBR</code></strong>仅使用第一个<strong><code>512bytes</code></strong>区块来记录分区信息不同，<strong><code>GPT</code></strong>使用了<strong><code>34</code></strong>个<strong><code>LBA</code></strong>区块来记录分区信息，<strong><code>GPT</code></strong>整个<strong>磁盘的最后<code>33</code>个<code>LBA</code></strong>也拿来作为另一个<strong>备份</strong>。</p>
<p>LBA0与MBR模式相似，该兼容区块也分为两个部份，一个是跟之前<strong><code>446bytes</code></strong>相似的区块，储存了第一阶段的开机管理程序，而在原本的分区表的纪录区内，该兼容模式仅放入一个<strong>特殊标志</strong>的分区，用来表示此磁盘为<strong><code>GPT</code></strong>格式，而不懂GPT分区表的磁盘管理程序，则不会识别这颗磁盘，除非用户有特别要求要处理该磁盘，否则该管理软件不能修改此分区信息，进一步保护了此磁盘。</p>
<p>LBA1为GPT表头纪录，记录了<strong>分区表本身的位置与大小</strong>，同时记录了备份用的<strong><code>GPT</code></strong>分区即在最后34个<strong><code>LBA</code></strong>区块放置的位置， 同时放置了<strong>分区表</strong>的<strong>检验机制码<code>CRC32</code></strong>，<strong>操作系统可根据该检验码来判断GPT是否正确</strong>，若有错误还可透过该记录区来取得备份的GPT即磁盘最后的<strong>备份区块</strong>来恢复GPT的正常运作。</p>
<p><strong><code>LBA2-33</code></strong>是<strong>实际记录分区信息</strong>处，从<strong><code>LBA2</code></strong>区块开始<strong>每个<code>LBA</code></strong>都可纪录<strong><code>4</code>个</strong>分区纪录，默认总共可有<strong><code>4*32 = 128</code></strong>个分区记录，因为每个LBA有<strong><code>512bytes</code></strong>，因此每个记录用到<strong><code>128bytes</code></strong>的空间，除了每笔记录所需要的标识符与相关的纪录之外，GPT在每笔纪录中分别提供<strong><code>64bits</code></strong>来记载<strong>开始和结束扇区号码</strong>，因此GPT分区表对于单一分区槽来说， 其<strong>最大容量限制</strong>在<strong><code>264 * 512bytes = 263 * 1Kbytes = 233*TB = 8 ZB</code></strong>，注意<strong><code>1ZB = 230TB</code></strong>。</p>
<p>现在GPT分区预设可以提供多达<strong><code>128</code></strong>笔纪录，Linux本身核心装置纪录中，针对单一磁盘来说，虽然过去最多只能到达15个分区槽，但由于Linux kernel透过<strong><code>udev</code></strong>等方式的处理，现在Linux已经没有该限制了，且<strong><code>GPT</code></strong>分区没有<strong>主、延伸、逻辑分区</strong>的概念，每笔纪录都可独立存在，每个都可视为主分区，每一个分区都可拿来格式化使用。  </p>
<h3 id="BIOS与UEFI"><a href="#BIOS与UEFI" class="headerlink" title="BIOS与UEFI"></a>BIOS与UEFI</h3><p>目前的主机系统在加载<strong>硬件驱动方面的程序</strong>，主要有早期的<strong><code>BIOS</code></strong>与新的<strong><code>UEFI</code></strong>两种机制，<strong><code>CMOS</code></strong>是记录各项<strong>硬件参数</strong>且<strong>嵌入在主板上面的储存器</strong>，BIOS则是一个写入到主板上的一个软件程序，即开机时计算机系统会主动执行的第一个程序。</p>
<p>以硬盘为例，<strong><code>BIOS</code></strong>会依据使用者的设定去<strong>获取能开机的硬盘</strong>，且到该硬盘中<strong>读取第一个扇区的<code>MBR</code>位置</strong>，<strong><code>MBR</code></strong>中仅有<strong><code>446 bytes</code></strong>的硬盘容量里面会放置<strong>最基本的开机管理程序</strong>， 此时BIOS就功成圆满，接下来就是<strong><code>MBR</code></strong>内的<strong>开机管理程序</strong>的工作了，<strong>开机管理程序的目的是在加载核心文件</strong>。 </p>
<p>整个开机流程到操作系统之前的动作，若分区表为GPT格式，则BIOS也能够从LBA0的MBR兼容区块读取第一阶段的开机管理程序代码：</p>
<ul>
<li><strong><code>BIOS</code></strong>：开机主动执行的程序，会识别第一个可开机的装置</li>
<li><strong><code>MBR</code></strong>：第一个可开机装置的第一个扇区内的主要启动记录区块，内含<strong>开机管理程序</strong></li>
<li><strong>boot loader开机管理程序</strong>：一支可<strong>读取核心文件来执行</strong>的软件<ul>
<li><strong>提供选单</strong>：用户可选择不同的开机项目，即<strong>多重引导的重要功能</strong></li>
<li><strong>载入核心文件</strong>：直接指向可开机的程序区段来开始操作系统</li>
<li><strong>转交其他loader</strong>：将开机管理功能转交给其他loader负责，可能具有多个开机管理程序</li>
</ul>
</li>
<li><strong>核心文件</strong>：开始操作系统的功能</li>
</ul>
<h3 id="文件系统"><a href="#文件系统" class="headerlink" title="文件系统"></a>文件系统</h3><p>Linux文件系统通常会将<strong>权限与属性放置到<code>inode</code>中</strong>，且<strong>一个文件占用一个<code>inode</code></strong>同时记录<strong>此文件的数据所在的<code>block</code>号码</strong>，<strong>实际数据则放置到<code>data block</code>区块中</strong>若文件比较大会<strong>占用多个<code>block</code></strong>；还有一个<strong>超级区块 <code>superblock</code></strong>会记录整个文件系统的<strong>整体信息</strong>包括<strong><code>inode</code></strong>与<strong><code>block</code></strong>的<strong>总量</strong>、<strong>使用量</strong>、<strong>剩余量</strong>以及<strong>文件系统的格式</strong>与相关信息；每个<strong><code>inode</code></strong>与<strong><code>block</code></strong>都有编号，这种文件系统称为<strong>索引式文件系统</strong>，<strong>基本上不需要进行碎片整理</strong>；</p>
<p>除此之外还有FAT格式的文件系统，<strong>FAT文件系统没有<code>inode</code></strong>，每个block号码都记录在<strong>前一个<code>block</code>中</strong>，只能一个一个的读取，若同一个文件数据写入block太过分散，磁头无法再磁盘转一圈就读取到所有数据，通常<strong>碎片整理</strong>的原因就是文件写入的block太过离散文件读取很差，此时可通过碎片整理将同一个文件所属的blocks汇整在一起，<strong><code>FAT</code>文件系统需要经常的碎片整理</strong>一下；</p>
<p><strong>标准<code>Linux</code>文件系统<code>Ext2</code></strong>就是使用<strong><code>inode</code>为基础</strong>的文件系统，且文件系统一开始就将inode与block规划好了，除非重新格式化或利用<strong><code>resize2fs</code></strong>等指令变更文件系统大小，否则inode与block固定后就不再变动；Ext2文件系统在格式化时基本上是区分为多个区块群组，每个区块群组都有独立的<strong><code>inode/block/superblock</code></strong>系统；整体的规划当中<strong>文件系统最前面有一个启动扇区<code>boot sector</code></strong>，该启动扇区可安装开机管理程序；</p>
<p>Ext2文件系统中所支持的block大小有<strong><code>1K</code></strong>、<strong><code>2K</code></strong>、<strong><code>4K</code></strong>三种；在<strong>格式化时block的大小就固定</strong>了且每个block都有编号，以便inode的记录；block大小的差异会导致该文件系统能够支持的<strong>最大磁盘容量</strong>与<strong>最大单一文件容量</strong>不相同；每个block内最多<strong>只能够放置一个文件</strong>的数据；若<strong>文件大于block则一个文件会占用多个block，若小于block则该block的剩余容量就不能够再被使用了，会造成磁盘空间会浪费</strong>；</p>
<p><img src="../../../../../images/Linux/block限制.png" alt></p>
<p>inode记录的文件<strong>权限rwx、拥有者、组、容量、创建或状态改变时间<code>ctime</code>、最近一次读取时间<code>atime</code>、最近修改时间<code>mtime</code>、<code>SUID</code>、<code>SGID</code>、<code>SBIT</code>、该文件<code>block</code>编号</strong>；且每个Inode大小固定为<strong><code>128bytes</code></strong>，新的<strong><code>ext4</code></strong>与<strong><code>xfs</code></strong>可设定到<strong><code>256 bytes</code></strong>；每个文件都仅占用一个inode；文件系统能够建立的文件数量与inode的数量有关；系统读取文件时需先找到inode并分析inode所记录的权限与用户是否符合，若符合才能够开始实际读取block的内容；</p>
<p><strong><code>inode</code></strong>记录一个<strong><code>block</code></strong>号码要<strong><code>4byte</code></strong>，inode记录block号码的区域定义为<strong><code>12</code>个直接</strong>、<strong>一个间接</strong>、<strong>一个双间接</strong>与<strong>一个三间接</strong>记录区；12个直接即<strong>直接存储<code>12</code>个<code>block</code>编号</strong>；所谓的间接就是<strong>再拿一个<code>block</code>来记录<code>block</code>号码</strong>；双间接即第一个block仅再指出下一个记录编号的block；实际记录的在第二个block；<strong>三间接</strong>就是利用<strong>第三层<code>block</code>来记录编号</strong>；</p>
<p>以<strong>1K的block</strong>为例，能够容纳的最大文件为<strong><code>16GB = 12 + 256 + 65536 +  16777216</code></strong>，该方法<strong>不能用在<code>2K</code>和<code>4K</code>的block大小的计算</strong>， 因为<strong>大于<code>2K</code>的<code>block</code>将会受到<code>Ext2</code>文件系统本身的限制</strong>计算结果会不太符合：</p>
<ul>
<li><strong><code>12</code>个直接</strong>：<strong><code>12 X 1K = 12K</code></strong></li>
<li><strong>间接</strong>：每个block编号4byte，一个1K的block可存储256个block编号，故<strong><code>256 X 1K = 256K</code></strong></li>
<li><strong>双间接</strong>：<strong><code>256 X 256 X 1K = 65536K</code></strong></li>
<li><strong>三间接</strong>：<strong><code>256 X 256 X 256 X 1K = 16777216K</code></strong></li>
</ul>
<h5 id="superblock"><a href="#superblock" class="headerlink" title="superblock"></a>superblock</h5><p><strong><code>Superblock</code></strong>是记录整个filesystem相关信息的地方，<strong>大小为<code>1024bytes</code></strong>，主要记录<strong><code>block</code></strong>与<strong><code>inode</code></strong>的<strong>数量</strong>；<strong>使用</strong>和<strong>未使用</strong>的<strong><code>inode</code></strong>和<strong><code>block</code></strong>的数量；单个block和inode的大小，<strong><code>block</code></strong>为<strong><code>1, 2, 4K</code></strong>，<strong><code>inode</code></strong>为<strong><code>128bytes</code></strong>或<strong><code>256bytes</code></strong>；filesystem的<strong>挂载时间</strong>、<strong>最近一次写入数据的时间</strong>、<strong>最近一次检验磁盘<code>fsck</code>的时间</strong>等；以及一个<strong><code>valid bit</code></strong>数值，若此文件系统<strong>已被挂载</strong>则<strong><code>valid bit</code></strong>为<strong><code>0</code></strong>若<strong>未被挂载</strong>则<strong><code>valid bit</code></strong>为<strong><code>1</code></strong>；</p>
<p>每个<strong><code>block group</code></strong>都可能含有<strong><code>superblock</code></strong>，但<strong>一个文件系统应该仅有一个<code>superblock</code></strong>，事实上除了<strong>第一个block group</strong>内会含有<strong><code>superblock</code></strong>之外，<strong>后续block group不一定含有superblock</strong>若含有则该superblock主要是<strong>做为第一个block group内superblock的备份</strong>；</p>
<h5 id="Filesystem-Description"><a href="#Filesystem-Description" class="headerlink" title="Filesystem Description"></a>Filesystem Description</h5><p>该区段可<strong>描述每个block group的开始与结束的block号码</strong>，以及说明每个区段superblock，bitmap，inodemap，data block分别介于哪一个block号码之间；</p>
<h5 id="block-bitmap-amp-inode-bitmap"><a href="#block-bitmap-amp-inode-bitmap" class="headerlink" title="block bitmap &amp; inode bitmap"></a>block bitmap &amp; inode bitmap</h5><p><strong><code>block bitmap</code></strong>用于记录使用与未使用的block；<strong><code>inode bitmap</code></strong>用于记录使用与未使用的inode；</p>
<h4 id="常用指令"><a href="#常用指令" class="headerlink" title="常用指令"></a>常用指令</h4><p>可以使用<strong><code>dumpe2fs</code></strong>指令查询<strong><code>Ext</code></strong>家族<strong><code>superblock</code></strong>信息，<strong><code>blkid</code></strong>指令可列出系统<strong>有被格式化的设备</strong>； </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">dumpe2fs [-bh] 装置文件名</span><br><span class="line">选项与参数：</span><br><span class="line">    -b ：列出保留为坏轨的部分，一般用不到</span><br><span class="line">    -h ：仅列出superblock的数据，不会列出其他的区段内容</span><br></pre></td></tr></table></figure>
<p>Linux文件系统创建目录时文件系统会<strong>分配一个<code>inode</code>与至少一块<code>block</code>给该目录</strong>，其中<strong><code>inode</code></strong>记录<strong>该目录的相关权限与属性</strong>，并可记录分配到的block号码；而block则记录<strong>该目录下的文件名与该文件名占用的<code>inode</code>数据</strong>；可通过<strong><code>ls -i</code></strong>选项来查看<strong>文件所对应的<code>inode</code>号码</strong>；当使用<strong><code>ls -l</code></strong>时出现的目录几乎都是1024的倍数，因为每个block的容量都是<strong><code>1K, 2K, 4</code>K</strong>；<strong>目录并不只会占用一个<code>block</code></strong>，若<strong>目录中文件数太多</strong>而导致<strong>一个block无法容纳下所有的文件名和其对应的inode对照表</strong>时，Linux会给予该目录多个block；</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ll -d / /boot /usr/sbin /proc /sys</span><br><span class="line">drwxr-xr-x.  18 root root  4096 12月 10 19:28 /			# 1 个 4K block</span><br><span class="line">dr-xr-xr-x.   5 root root  4096 2月  16 2022 /boot		# 1 个 4K block</span><br><span class="line">dr-xr-xr-x  203 root root     0 12月 11 03:27 /proc		# 为内存内数据，不占磁盘容量</span><br><span class="line">dr-xr-xr-x   13 root root     0 12月 11 03:27 /sys		# 为内存内数据，不占磁盘容量</span><br><span class="line">dr-xr-xr-x.   2 root root 20480 2月  18 2022 /usr/sbin		# 5 个 4K block</span><br></pre></td></tr></table></figure>
<p>Linux下的<strong><code>ext2</code>文件系统</strong>中创建一个一般文件时， ext2文件系统会<strong>分配一个<code>inode</code>与相对于该文件大小的<code>block</code>数量</strong>给该文件，如假设一个 block为<strong><code>4 Kbytes</code></strong>，而要建立一个100 KBytes的文件，则linux将分配一个inode与25 个 block来储存该文件，注意由于<strong><code>inode</code>仅有<code>12</code>个直接指向</strong>，因此还要多一个block来作为区块号码的记录；</p>
<p><strong><code>inode</code></strong>本身并<strong>不记录文件名</strong>，<strong>文件名是记录在目录的<code>block</code>中</strong>，因此<strong>新增/删除/修改文件名</strong>与<strong>目录的<code>w</code>权限</strong>有关，读取某个文件时务必会经过目录的inode与block，然后才能够找到待读取文件的inode号码，最终才会读到该文件的block内的数据；</p>
<p>当<strong>新建一个文件时</strong>，文件系统会<strong>先确定</strong>用户对于<strong>欲新增文件的目录是否具有w与x的权限</strong>，若有才能新增；根据<strong><code>inode bitmap</code></strong>找到<strong>未被使用的<code>inode</code></strong>，并将新文件的<strong>权限/属性写入</strong>；根据<strong><code>block bitmap</code></strong>找到<strong>未被使用的<code>block</code></strong>，并将<strong>实际的数据写入block</strong>中，且<strong>更新inode的block指向数据</strong>；将刚刚写入的inode与block数据<strong>同步更新inode bitmap与block bitmap</strong>，并<strong>更新superblock</strong>内容；</p>
<p>早期Ext2文件系统中，若发生数据不一致问题，系统在重启时会通过superblock中记录的valid bit与filesystem state等状态来判断是否强制进行数据一致性检查，需要检查时通过e2fsck程序来完成；若文件系统有100G以上且文件非常多时，检查会非常耗时；为了避免该问题文件系统中专门规划出一个区块，用于记录写入或修改文件时的步骤：当系统要写入一个文件时，会<strong>先在日志记录区块中纪录某个文件准备要写入的信息</strong>，然后<strong>写入文件的权限与数据</strong>，更新<strong><code>superblock、block bitmap、inode bitmap</code></strong>的数据，在日志记录区块当中完成该文件的纪录；万一发生不一致问题系统只需检查日志记录区块，而不必针对整块filesystem去检查；</p>
<p>所有的数据都要加载到内存后CPU才能对该数据进行处理，若编辑一个很大的文件在编辑过程中又频繁的要系统来写入到磁盘中，由于磁盘写入速度比内存慢很多，因此会等待磁盘写入/读取，为了解决该效率问题，Linux使用异步处理的方式；当系统加载一个文件到内存，若该文件未被修改，则在内存区段的文件数据会被设定为干净的，若内存中的文件数据被修改过，此时该内存中的数据会被设定为脏的，此时所有的动作都还在内存中执行，并没有写入到磁盘中，系统会不定时的将内存中设定为脏的数据写回磁盘，以保持磁盘与内存数据的一致性，也可利用<strong><code>sync</code></strong>指令来手动强迫写入磁盘；若<strong>正常关机</strong>时关机指令会<strong>主动调用sync</strong>来将内存的数据回写入磁盘内；</p>
<p>将<strong>文件系统</strong>与<strong>目录树</strong>结合的动作称为<strong>挂载</strong>，<strong>挂载点一定是目录</strong>，该目录为进入该文件系统的入口，CentOS 7.x应该会有<strong><code>/, /boot, /home</code></strong>三个挂载点，如下可以发现<strong><code>/, /boot, /home</code></strong>为<strong>三个不同的filesystem</strong>，因为每一行的文件属性并不相同，且三个目录的挂载点也均不相同：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ls -lid / /boot /home</span><br><span class="line">64 drwxr-xr-x. 18 root root 4096 12月 10 19:28 /</span><br><span class="line">64 dr-xr-xr-x.  5 root root 4096 2月  16 2022 /boot</span><br><span class="line">64 drwxr-xr-x.  5 root root   50 7月  31 2022 /home</span><br></pre></td></tr></table></figure>
<p><strong>同一个<code>filesystem</code>的某个<code>inode</code>只会对应到一个文件内容</strong>，可通过判断<strong><code>inode</code></strong>来确认不同文件名是否为相同的文件，由于<strong>挂载点均为<code>/</code></strong>，因此三个文件<strong><code>/, /., /..</code></strong>均在同一个filesystem内，而这三个文件的inode号码均为64，因此这三个文件都指向同一个inode，故这三个文件的内容也就完全一样:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ls -ild / /. /..</span><br><span class="line">64 drwxr-xr-x. 18 root root 4096 12月 10 19:28 /</span><br><span class="line">64 drwxr-xr-x. 18 root root 4096 12月 10 19:28 /.</span><br><span class="line">64 drwxr-xr-x. 18 root root 4096 12月 10 19:28 /..</span><br></pre></td></tr></table></figure>
<p>Linux标准文件系统是<strong><code>ext2</code></strong>，且还有增加了日志功能的<strong><code>ext3</code></strong>和<strong><code>ext4</code></strong>，Linux还支持很多文件系统格式，尤其是最近几年推出了好几种速度很快的日志式文件系统，包括<strong><code>SGI</code></strong>的<strong><code>XFS</code></strong>文件系统，可适用更小型文件的<strong><code>Reiserfs</code></strong>文件系统，以及Windows的<strong><code>FAT</code></strong>文件系统等，Linux常见的支持文件系统有：</p>
<ul>
<li><strong>传统文件系统</strong>：<strong><code>ext2</code></strong>、<strong><code>minix</code></strong>、<strong><code>MS-DOS</code></strong>、<strong><code>FAT</code></strong> (用vfat模块) 、<strong><code>iso9660</code></strong> (光盘)等等；</li>
<li><strong>日志式文件系统</strong>： <strong><code>ext3</code></strong>、<strong><code>ext4</code></strong>、<strong><code>ReiserFS</code></strong>、<strong><code>Windows&#39; NTFS</code></strong>、<strong><code>IBM&#39;s JFS</code></strong>、<strong><code>SGI&#39;s XFS</code></strong>、<strong><code>ZFS</code></strong></li>
<li><strong>网络文件系统</strong>： <strong><code>NFS</code></strong>、<strong><code>SMBFS</code></strong></li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 查看支持的文件系统有哪些</span><br><span class="line">ls -l /lib/modules/$(uname -r)/kernel/fs</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 系统目前已加载到内存中支持的文件系统</span><br><span class="line">cat /proc/filesystems</span><br></pre></td></tr></table></figure>
<p>整个Linux系统都是通过<strong><code>Virtual Filesystem Switch</code></strong>即<strong><code>VFS</code></strong>的核心功能去读取filesystem的，使用者并不需要知道每个partition的filesystem是什么，都是通过<strong><code>VFS</code></strong>的功能来管理所有的filesystem；</p>
<h4 id="XFS"><a href="#XFS" class="headerlink" title="XFS"></a>XFS</h4><p><strong>CentOS 7开始预设文件系统</strong>已经由<strong><code>EXT4</code></strong>变成了<strong><code>XFS</code></strong>文件系统，Ext文件系统采用的是<strong>预先规划</strong>出所有<strong><code>inode/block/metadata</code></strong>等数据，未来系统可直接取用不需要再进行动态配置，面对磁盘容量越来越大，系统<strong>预先分配inode和block的时间</strong>以及<strong>格式化的时间</strong>会越来越长；由于虚拟化的应用越来越广泛，而作为虚拟化磁盘来源的巨型文也就越来越常见，因此从<strong><code>CentOS 7.x</code></strong>开始文件系统已经由预设的<strong><code>Ext4</code></strong>变成了较适合<strong>高容量磁盘</strong>与<strong>巨型文件效率较佳</strong>的文件系统<strong><code>xfs</code></strong>；</p>
<p>xfs是一个<strong>日志式文件系统</strong>，几乎所有Ext4文件系统有的功能xfs都可以具备，xfs文件系统主要规划为三个部份：</p>
<ul>
<li><strong>数据区data section</strong>：包括<strong><code>inode/data block/superblock</code></strong>等数据，分为<strong>多个储存区群组<code>allocation groups</code></strong>来分别放置文件系统所需要的数据，且<strong>inode与block</strong>系统<strong>用到时才动态配置产生</strong>，所以格式化速度快，<strong><code>block</code>容量</strong>可由<strong><code>512bytes ~ 64K</code></strong>调配，但Linux由于内存控制关系<strong>最高可使用的block大小为<code>4K</code></strong>，超过4K就挂载不了，<strong>inode容量</strong>可由<strong><code>256bytes~2M</code></strong>，每个<code>allocation groups</code>储存区群组都包含了以下几项：<ul>
<li>整个文件系统的<strong><code>superblock</code></strong></li>
<li><strong>剩余空间的管理机制</strong></li>
<li>inode的<strong>分配</strong>与<strong>追踪</strong> </li>
</ul>
</li>
<li><strong>文件系统活动登录区log section</strong>：主要被用来<strong>记录文件系统的变化</strong>，有点像是日志区，文件的变化会在这里记录下来，直到该变化完整的写入到数据区后，该笔纪录才会被终结，若出现数据一致性问题系统会拿该区块来进行检验，藉以快速的修复文件系统；<strong>该区域可以指定外部的磁盘</strong>如<strong><code>SSD</code></strong>；  </li>
<li><strong>实时运行区realtime section</strong>：当创建文件时xfs会在该区段找<strong><code>1~N</code></strong>个<strong><code>extent</code></strong>区块，将文件放置在该区块内，等到分配完毕后，再写入到data section的inode与block，该extent区块的大小需在<strong>格式化时就指定</strong>，最小值<strong><code>4K</code></strong>最大<strong><code>1G</code></strong>；</li>
</ul>
<p>可使用<strong><code>xfs_info</code></strong>命令查询<strong><code>XFS</code></strong>文件系统的<strong><code>superblock</code></strong>内容，类似于EXT文件系统中的<strong><code>dumpe2fs</code></strong>命令</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">xfs_info 挂载点|装置文件名</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 找出系统/boot挂载点下的文件系统的superblock记录</span><br><span class="line">df -T /boot</span><br><span class="line">文件系统       类型  1K-块   已用   可用 已用% 挂载点</span><br><span class="line">/dev/sda2      xfs  972452 222216 750236   23% /boot</span><br><span class="line"></span><br><span class="line">xfs_info /dev/sda2</span><br><span class="line">meta-data=/dev/sda2              isize=512    agcount=4, agsize=60992 blks</span><br><span class="line">         =                       sectsz=512   attr=2, projid32bit=1</span><br><span class="line">         =                       crc=1        finobt=0 spinodes=0</span><br><span class="line">data     =                       bsize=4096   blocks=243968, imaxpct=25</span><br><span class="line">         =                       sunit=0      swidth=0 blks</span><br><span class="line">naming   =version 2              bsize=4096   ascii-ci=0 ftype=1</span><br><span class="line">log      =internal               bsize=4096   blocks=855, version=2</span><br><span class="line">         =                       sectsz=512   sunit=0 blks, lazy-count=1</span><br><span class="line">realtime =none                   extsz=4096   blocks=0, rtextents=0</span><br></pre></td></tr></table></figure>
<p><strong><code>isize</code></strong>为<strong><code>inode</code>的容量<code>512bytes</code></strong>，<strong><code>agcount</code></strong>为<strong>储存区群组<code>allocation group</code>的个数</strong>，<strong><code>agsize</code></strong>指每个<strong>储存区群组</strong>具有<strong><code>60992</code></strong>个<strong><code>block</code></strong>，<strong><code>bsize</code></strong>为<strong>block的容量4K</strong>，<strong><code>blocks</code></strong>为该文件系统<strong>block总数</strong>，整个文件系统的容量<strong><code>4 * 60992 * 4K</code></strong>；<strong><code>sectsz</code></strong>指<strong>逻辑扇区<code>sector</code>的容量</strong>，<strong><code>internal</code></strong>指文件系统活动登录区是在文件系统内不是在外部设备中，且占用<strong><code>4K * 855</code></strong>个block；<strong><code>realtime</code></strong>表示实时运行区<strong><code>extent</code></strong>容量为<strong><code>4K</code></strong>；</p>
<h4 id="磁盘与目录容量"><a href="#磁盘与目录容量" class="headerlink" title="磁盘与目录容量"></a>磁盘与目录容量</h4><p>磁盘的整体数据是在superblock区块中，但每个文件各自的容量则在inode当中记载的，可通过下面两个命令查询：</p>
<ul>
<li><strong><code>df</code></strong>：列出<strong>文件系统的整体磁盘使用量</strong>，<strong><code>df</code></strong>主要读取数据几乎都是针对整个文件系统，因此<strong>读取的主要是在<code>Superblock</code>内的信息</strong>，所以该指令显示结果速度非常快  </li>
<li><strong><code>du</code></strong>：评估文件系统的磁盘使用量，常用在推估目录所占容量，直接到文件系统内去搜寻所有的文件数据，</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 不加任何选项默认会将系统内所有不含特殊内存内的文件系统与swap，都以1 Kbytes的容量来列出来</span><br><span class="line">df [-ahikHTm] [目录或文件名]</span><br><span class="line">选项与参数：</span><br><span class="line">    -a ：列出所有的文件系统，包括系统特有的/proc等文件系统；</span><br><span class="line">    -k ：以 KBytes 的容量显示各文件系统；</span><br><span class="line">    -m ：以 MBytes 的容量显示各文件系统；</span><br><span class="line">    -h ：以人们较易阅读的 GBytes, MBytes, KBytes 等格式自行显示；</span><br><span class="line">    -H ：以 M=1000K 取代 M=1024K 的进位方式；</span><br><span class="line">    -T ：连同该 partition 的 filesystem 名称 (例如 xfs) 也列出；</span><br><span class="line">    -i ：不用磁盘容量，而以inode的数量来显示</span><br><span class="line">    </span><br><span class="line"><span class="meta">#</span> 将/etc底下的可用磁盘容量以易读的容量格式显示</span><br><span class="line">df -h /etc</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 不加任何选项默认会分析当前所在目录的文件与目录所占用的磁盘空间，实际显示时仅显示目录容量不显示文件，单位是K</span><br><span class="line">du [-ahskm] 文件或目录名称</span><br><span class="line">选项与参数：</span><br><span class="line">    -a ：列出所有的文件与目录容量，因为默认仅统计目录底下的文件量而已。</span><br><span class="line">    -h ：以人们较易读的容量格式 (G/M) 显示；</span><br><span class="line">    -s ：列出总量而已，而不列出每个目录占用容量；</span><br><span class="line">    -S ：不包括子目录下的总计，与 -s 有点差别。</span><br><span class="line">    -k ：以 KBytes 列出容量显示；</span><br><span class="line">    -m ：以 MBytes 列出容量显示；</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 检查根目录底下每个目录所占用的容量</span><br><span class="line">du -sm /*</span><br></pre></td></tr></table></figure>
<h4 id="链接"><a href="#链接" class="headerlink" title="链接"></a>链接</h4><p>每个文件都会占用一个inode，想要读取该文件必须要经过目录记录的文件名来指向到正确的inode号码才能读取，<strong>硬链接</strong>只是在<strong>某目录下</strong>新增一笔<strong>文件名链接到某<code>inode</code>号码的关联记录</strong>而已，<strong>既不会增加<code>inode</code>也不会消耗<code>block</code>数量</strong>，若新增的记录刚好将目录的block填满，还是会新增一个block；</p>
<p><img src="../../../../../images/Linux/硬链接示意图.png" alt></p>
<p>通过1或2的目录的inode指定的block找到两个不同的文件名，不管使用哪一个文件名均可指向real的inode去读取最终的数据，最大的好处是<strong>安全</strong>，若将任何一个文件名删除，inode和block都还存在；<strong>硬链接只能在单一文件系统中使用</strong>，不能跨文件系统，<strong>不能硬链接目录</strong>；若将/etc使用硬链接建立一个/etc_hd的目录时，则在/etc_hd下的所有文件同时都与/etc下的文件要建立hard link，而不仅链接到/etc_hd与/etc而已，且未来若需要在/etc_hd下创建新文件时，连带/etc下又得建立一次hard link，因此会造成环境相当大的复杂度；</p>
<p><img src="../../../../../images/Linux/跨文件系统不能硬链接.png" alt></p>
<p><strong>软链接</strong>即<strong><code>Symbolic link</code></strong>是建立一个独立的文件，而该文件会让数据的读取<strong>指向其<code>link</code>文件的<code>inode</code></strong>，与windows的快捷方式类似，<strong>会占用<code>inode</code>和<code>block</code></strong>，由于只是利用文件来做为指向的动作，<strong>当源文件删除后<code>symbolic link</code>的文件会打不开</strong>；</p>
<p><img src="../../../../../images/Linux/符号链接示意图.png" alt></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ln [-sf] 来源文件 目标文件</span><br><span class="line">选项与参数：</span><br><span class="line">    -s ：若不加任何参数即创建hard link，-s即symbolic link</span><br><span class="line">    -f ：若目标文件存在时，就主动的将目标文件直接移除后再创建</span><br></pre></td></tr></table></figure>
<p>关于目录的link数量，当<strong>新建目录时目录的<code>link</code>数为<code>2</code></strong>，而其<strong>上一层目录<code>link</code>数据会增加<code>1</code></strong>；因为存在<strong><code>.</code></strong>和<strong><code>..</code></strong>两个目录；</p>
<p><img src="../../../../../images/Linux/目录链接数据.png" alt></p>
<h4 id="磁盘分区-amp-格式化-amp-校验-amp-挂载"><a href="#磁盘分区-amp-格式化-amp-校验-amp-挂载" class="headerlink" title="磁盘分区&amp;格式化&amp;校验&amp;挂载"></a>磁盘分区&amp;格式化&amp;校验&amp;挂载</h4><p>对磁盘分区建立可用的partition，<strong>对<code>partition</code>进行格式化以建立可用的<code>filesystem</code></strong>，并对建立的filesystem进行检验，Linux上需建立挂载点即目录，将filesystem挂载到挂载点上；目前磁盘分区主要有<strong><code>MBR</code></strong>以及<strong><code>GPT</code></strong>两种格式，可分别使用<strong><code>fdisk</code></strong>和<strong><code>gdisk</code></strong>命令来<strong>处理分区</strong>；</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">lsblk [-dfimpt] [device]</span><br><span class="line">选项与参数：</span><br><span class="line">    -d ：仅列出磁盘本身，并不会列出该磁盘的分区数据</span><br><span class="line">    -f ：同时列出该磁盘内的文件系统名称</span><br><span class="line">    -i ：使用 ASCII 的线段输出，不要使用复杂的编码 (再某些环境下很有用)</span><br><span class="line">    -m ：同时输出该装置在 /dev 底下的权限数据 (rwx 的数据)</span><br><span class="line">    -p ：列出该装置的完整文件名！而不是仅列出最后的名字而已。</span><br><span class="line">    -t ：列出该磁盘装置的详细数据，包括磁盘队列机制、预读写的数据量大小等</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 列出本系统下的所有磁盘与磁盘内的分区信息</span><br><span class="line">lsblk</span><br><span class="line">NAME   MAJ:MIN RM   SIZE RO TYPE MOUNTPOINT</span><br><span class="line">sda      8:0    0 232.9G  0 disk </span><br><span class="line">├─sda1   8:1    0   476M  0 part /boot/efi</span><br><span class="line">├─sda2   8:2    0   953M  0 part /boot</span><br><span class="line">├─sda3   8:3    0   141G  0 part /home</span><br><span class="line">├─sda4   8:4    0  74.5G  0 part /</span><br><span class="line">└─sda5   8:5    0   5.6G  0 part </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 仅列出 /dev/vda 装置内的所有数据的完整文件名</span><br><span class="line">lsblk -ip /dev/sda</span><br><span class="line">NAME        MAJ:MIN RM   SIZE RO TYPE MOUNTPOINT</span><br><span class="line">/dev/sda      8:0    0 232.9G  0 disk </span><br><span class="line">|-/dev/sda1   8:1    0   476M  0 part /boot/efi</span><br><span class="line">|-/dev/sda2   8:2    0   953M  0 part /boot</span><br><span class="line">|-/dev/sda3   8:3    0   141G  0 part /home</span><br><span class="line">|-/dev/sda4   8:4    0  74.5G  0 part /</span><br><span class="line">`-/dev/sda5   8:5    0   5.6G  0 part</span><br></pre></td></tr></table></figure>
<ul>
<li><strong><code>NAME</code></strong>：设备名，会省略<strong><code>/dev</code></strong>等前导目录</li>
<li><strong><code>MAJ:MIN</code></strong>：设备主要代码，设备次要代码</li>
<li><strong><code>RM</code></strong>：是否为可卸除装置 (removable device)，如光盘、USB 磁盘等等</li>
<li><strong><code>SIZE</code></strong>：设备容量</li>
<li><strong><code>RO</code></strong>：是否为只读设备</li>
<li><strong><code>TYPE</code></strong>：是磁盘 (disk)、分区槽 (partition) 还是只读存储器 (rom) 等输出</li>
<li><strong><code>MOUTPOINT</code></strong>：挂载点</li>
</ul>
<p>可使用<strong><code>lsblk</code></strong>列出本系统下的<strong>所有磁盘与磁盘内的分区信息</strong>，可通过<strong><code>-f</code></strong>参数来列出<strong>文件系统</strong>与<strong>设备</strong>的<strong><code>UUID</code></strong>数据，也可以使用<strong><code>blkid</code></strong>命令来找出设备的<strong><code>UUID</code></strong>，UUID是全局唯一标识符，Linux会将系统内所有设备都给予一个独一无二的标识符，该标识符可拿来作为挂载或使用该设备或文件系统之用；  </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 列出本系统下的所有磁盘与磁盘内的分区信息</span><br><span class="line">lsblk -f</span><br><span class="line">NAME   FSTYPE LABEL UUID                                 MOUNTPOINT</span><br><span class="line">sda                                                      </span><br><span class="line">├─sda1 vfat         B99A-7DF9                            /boot/efi</span><br><span class="line">├─sda2 xfs          f0dda9b9-4595-4c0a-b084-b7c87808f83c /boot</span><br><span class="line">├─sda3 xfs          673e388b-5ac9-42e0-a29d-c76bd6b0bf22 /home</span><br><span class="line">├─sda4 xfs          fcb72d23-6dc8-40db-9065-590c3f8d2dbe /</span><br><span class="line">└─sda5 swap         9dc5c38e-fbd4-48dc-ab2b-15f772fbe19f </span><br><span class="line"></span><br><span class="line">blkid</span><br><span class="line">/dev/sda6: UUID="f0203a66-3bce-4d79-a40e-6f3a2396dcd5" TYPE="ext4" PARTLABEL="Linux filesystem" PARTUUID="20077c57-aa6f-4bd7-8f38-e6396a77c7a9" </span><br><span class="line">/dev/sda1: SEC_TYPE="msdos" UUID="B99A-7DF9" TYPE="vfat" PARTLABEL="EFI System Partition" PARTUUID="241fa0a3-b322-4ea1-96b0-71483861e8be" </span><br><span class="line">/dev/sda2: UUID="f0dda9b9-4595-4c0a-b084-b7c87808f83c" TYPE="xfs" PARTUUID="6eb73d00-2b3d-4f32-9d40-b7a5ae2254ab" </span><br><span class="line">/dev/sda3: UUID="673e388b-5ac9-42e0-a29d-c76bd6b0bf22" TYPE="xfs" PARTUUID="d5acb22f-2986-45bd-9a04-934c355cfce0" </span><br><span class="line">/dev/sda4: UUID="fcb72d23-6dc8-40db-9065-590c3f8d2dbe" TYPE="xfs" PARTUUID="e3b63683-bef8-4a9a-b793-7a05d3dd8d0e" </span><br><span class="line">/dev/sda5: UUID="9dc5c38e-fbd4-48dc-ab2b-15f772fbe19f" TYPE="swap" PARTUUID="8078106c-b330-45ad-aff5-cfb85dff23e7"</span><br></pre></td></tr></table></figure>
<p>可通过<strong><code>parted</code></strong>命令列出磁盘的<strong>分区表类型</strong>与<strong>分区信息</strong>，虽然可以使用gdisk和fdisk很快速的完成分区槽的分割，但gdisk主要针对GPT而fdisk主要支持MBR对GPT支持不够，使用不同的分区时，得要先查询到正确的分区表才能用适合的指令，非常麻烦，可以使用<strong>同时支持两种分区类型的命令<code>parted</code></strong>；</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">parted [装置] [指令 [参数]]</span><br><span class="line">选项与参数：</span><br><span class="line">    新增分区：mkpart [primary|logical|extended] [ext4|vfat|xfs] 开始 结束</span><br><span class="line">    显示分区：print</span><br><span class="line">    删除分区：rm [partition]</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 列出/dev/sda磁盘的相关数据</span><br><span class="line">parted /dev/sda print</span><br><span class="line">Model: ATA Samsung SSD 750 (scsi)</span><br><span class="line">Disk /dev/sda: 250GB</span><br><span class="line">Sector size (logical/physical): 512B/512B</span><br><span class="line">Partition Table: gpt</span><br><span class="line">Disk Flags: </span><br><span class="line"></span><br><span class="line">Number  Start   End     Size    File system     Name                  标志</span><br><span class="line"> 1      1049kB  500MB   499MB   fat16           EFI System Partition  启动</span><br><span class="line"> 2      500MB   1499MB  999MB   xfs</span><br><span class="line"> 3      1499MB  153GB   151GB   xfs</span><br><span class="line"> 4      153GB   233GB   80.0GB  xfs</span><br><span class="line"> 5      233GB   239GB   6000MB  linux-swap(v1)</span><br><span class="line"> 6      239GB   240GB   1074MB  ext4            Linux filesystem</span><br><span class="line"> 7      240GB   241GB   537MB   linux-swap(v1)  Linux swap</span><br><span class="line"> </span><br><span class="line"><span class="meta">#</span> 固定使用MB作为单位显示</span><br><span class="line">parted /dev/vda unit mb print</span><br><span class="line"><span class="meta">#</span> 将/dev/sda这个原本的MBR分区表变成GPT分区表</span><br><span class="line">parted /dev/sda mklabel gpt</span><br><span class="line"><span class="meta">#</span> 建立一个约为512MB容量的分区槽</span><br><span class="line">parted /dev/vda mkpart primary fat32 36.0GB 36.5GB</span><br><span class="line"> </span><br><span class="line"><span class="meta">#</span> 删除编号为7的分区</span><br><span class="line">parted /dev/vda rm 7</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">gdisk /dev/sda</span><br><span class="line">GPT fdisk (gdisk) version 0.8.10</span><br><span class="line"></span><br><span class="line">Partition table scan:</span><br><span class="line">  MBR: protective</span><br><span class="line">  BSD: not present</span><br><span class="line">  APM: not present</span><br><span class="line">  GPT: present</span><br><span class="line"></span><br><span class="line">Found valid GPT with protective MBR; using GPT.		# 找到了 GPT 的分区表</span><br><span class="line"></span><br><span class="line">Command (? for help): ?				# 可输入指令动作，可以按问号 (?) 来查看可用指令</span><br><span class="line">b       back up GPT data to a file</span><br><span class="line">c       change a partition's name</span><br><span class="line">d       delete a partition		# 删除一个分区</span><br><span class="line">i       show detailed information on a partition</span><br><span class="line">l       list known partition types</span><br><span class="line">n       add a new partition		# 增加一个分区</span><br><span class="line">o       create a new empty GUID partition table (GPT)</span><br><span class="line">p       print the partition table		# 印出分区表 (常用)</span><br><span class="line">q       quit without saving changes		# 不储存分区就直接离开 gdisk</span><br><span class="line">r       recovery and transformation options (experts only)</span><br><span class="line">s       sort partitions</span><br><span class="line">t       change a partition's type code</span><br><span class="line">v       verify disk</span><br><span class="line">w       write table to disk and exit		# 储存分区操作后离开 gdisk</span><br><span class="line">x       extra functionality (experts only)</span><br><span class="line">?       print this menu</span><br><span class="line"></span><br><span class="line">Command (? for help): p</span><br><span class="line">Disk /dev/sda: 488397168 sectors, 232.9 GiB</span><br><span class="line">Logical sector size: 512 bytes</span><br><span class="line">Disk identifier (GUID): 7B10AC68-EEE7-42BC-9088-3BB71109903A</span><br><span class="line">Partition table holds up to 128 entries</span><br><span class="line">First usable sector is 34, last usable sector is 488397134</span><br><span class="line">Partitions will be aligned on 2048-sector boundaries</span><br><span class="line">Total free space is 21805357 sectors (10.4 GiB)</span><br><span class="line"></span><br><span class="line">Number  Start (sector)    End (sector)  Size       Code  Name</span><br><span class="line">   1            2048          976895   476.0 MiB   EF00  EFI System Partition</span><br><span class="line">   2          976896         2928639   953.0 MiB   0700  </span><br><span class="line">   3         2928640       298627071   141.0 GiB   0700  </span><br><span class="line">   4       298627072       454875135   74.5 GiB    0700  </span><br><span class="line">   5       454875136       466593791   5.6 GiB     8200</span><br></pre></td></tr></table></figure>
<p>首先通过<strong><code>lsblk</code></strong>或<strong><code>blkid</code></strong>先<strong>找到磁盘</strong>，再用<strong><code>parted /dev/xxx print</code></strong>来<strong>找出内部的分区表类型</strong>，之后才用<strong><code>gdisk</code></strong>或<strong><code>fdisk</code></strong>来<strong>操作系统</strong>，注意<strong>使用设备名请不要加上数字</strong>，因为<strong>partition是针对整个磁盘设备</strong>的而不是某个partition，故执行<strong><code>gdisk /dev/vda1</code></strong>会发生错误； </p>
<ul>
<li><strong><code>Number</code></strong>：<strong>分区槽编</strong>号，<strong><code>1</code></strong>号指的是<strong><code>/dev/vda1</code></strong></li>
<li><strong><code>Start (sector)</code></strong>：每一个分区槽的<strong>开始扇区号码位置</strong></li>
<li><strong><code>End (sector)</code></strong>：每一个分区的<strong>结束扇区号码位置</strong>，与 start 之间可以算出分区槽的总容量</li>
<li><strong><code>Size</code></strong>：就是<strong>分区槽的容量</strong></li>
<li><strong><code>Code</code></strong>：在分区槽内的可能的<strong>文件系统类型<code>Linux</code>为<code>8300</code></strong>，<strong><code>swap</code>为<code>8200</code></strong>  </li>
<li><strong><code>Name</code></strong>：文件<strong>系统的名称</strong></li>
</ul>
<p>当创建新的分区后，因为这颗磁盘目前正在使用当中，因此系统无法立即加载新的分区表，可通过<strong>重启</strong>或<strong><code>partprobe</code></strong>命令来处理</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">cat /proc/partitions</span><br><span class="line">major minor  #blocks  name</span><br><span class="line"></span><br><span class="line">   8        0  244198584 sda</span><br><span class="line">   8        1     487424 sda1</span><br><span class="line">   8        2     975872 sda2</span><br><span class="line">   8        3  147849216 sda3</span><br><span class="line">   8        4   78124032 sda4</span><br><span class="line">   8        5    5859328 sda5</span><br><span class="line"> </span><br><span class="line">partprobe -s</span><br><span class="line">/dev/sda: gpt partitions 1 2 3 4 5 6</span><br><span class="line"></span><br><span class="line">lsblk /dev/sda</span><br><span class="line">NAME   MAJ:MIN RM   SIZE RO TYPE MOUNTPOINT</span><br><span class="line">sda      8:0    0 232.9G  0 disk </span><br><span class="line">├─sda1   8:1    0   476M  0 part /boot/efi</span><br><span class="line">├─sda2   8:2    0   953M  0 part /boot</span><br><span class="line">├─sda3   8:3    0   141G  0 part /home</span><br><span class="line">├─sda4   8:4    0  74.5G  0 part /</span><br><span class="line">├─sda5   8:5    0   5.6G  0 part </span><br><span class="line">└─sda6   8:6    0     1G  0 part</span><br></pre></td></tr></table></figure>
<p><strong><code>fdisk</code></strong>跟<strong><code>gdisk</code></strong>使用的方式几乎一样，</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">fdisk /dev/sda </span><br><span class="line">WARNING: fdisk GPT support is currently new, and therefore in an experimental phase. Use at your own discretion.</span><br><span class="line">欢迎使用 fdisk (util-linux 2.23.2)。</span><br><span class="line"></span><br><span class="line">更改将停留在内存中，直到您决定将更改写入磁盘。</span><br><span class="line">使用写入命令前请三思。</span><br><span class="line"></span><br><span class="line">命令(输入 m 获取帮助)：m</span><br><span class="line">命令操作</span><br><span class="line">   d   delete a partition		# 删除一个 partition</span><br><span class="line">   g   create a new empty GPT partition table</span><br><span class="line">   G   create an IRIX (SGI) partition table</span><br><span class="line">   l   list known partition types</span><br><span class="line">   m   print this menu</span><br><span class="line">   n   add a new partition		# 新增一个 partition</span><br><span class="line">   o   create a new empty DOS partition table</span><br><span class="line">   p   print the partition table		# 在屏幕上显示分区表</span><br><span class="line">   q   quit without saving changes		# 不储存离开 fdisk 程序</span><br><span class="line">   s   create a new empty Sun disklabel</span><br><span class="line">   t   change a partition's system id</span><br><span class="line">   v   verify the partition table</span><br><span class="line">   w   write table to disk and exit</span><br><span class="line">   x   extra functionality (experts only)</span><br></pre></td></tr></table></figure>
<p>分区完成后需要对文件系统格式化，<strong>格式化命令为<code>mkfs</code></strong>，应该称为<strong>构建文件系统<code>make filesystem</code></strong>才对，<strong><code>agcount</code></strong>可根据<strong>CPU的核心数</strong>来设定，可通过<strong><code>grep &#39;processor&#39; /proc/cpuinfo</code></strong>查询系统CPU核心数；<strong><code>RAID</code></strong>表示<strong>磁盘阵列</strong>，<strong>分区区块<code>stripe</code></strong>的数值大多介于<strong><code>4K</code></strong>到<strong><code>1M</code></strong>之间，与<strong>文件数据容量</strong>以及<strong>性能</strong>相关性较高，若系统<strong>大多是大型文件时</strong>建议<strong>分区区块<code>stripe</code>设置大一些</strong>，磁盘阵列<strong>读/写</strong>频率会降低性能能会提升；若<strong>小文件比较多分区区块<code>stripe</code>建议设置为<code>64K</code>左右</strong>；</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">mkfs.xfs [-b bsize] [-d parms] [-i parms] [-l parms] [-L label] [-f] [-r parms] 装置名称</span><br><span class="line">选项与参数：</span><br><span class="line">单位：只要谈到数值时，没有加单位则为bytes，可用k,m,g,t,p小写等来解释比较特殊的是s这个单位，它指的是sector的个数</span><br><span class="line">-b ：后面接的是block容量，可由512到64k，Linux最大容量限制为4k</span><br><span class="line">-d ：后面接的是data section的相关参数值，主要的值有：</span><br><span class="line">    agcount=数值 ：设定需要几个储存群组的意思(AG)，通常与CPU有关</span><br><span class="line">    agsize=数值 ：每个AG设定为多少容量的意思，通常agcount/agsize只选一个设定即可</span><br><span class="line">    file ：指的是格式化的装置是个文件而不是个设备(如虚拟磁盘)</span><br><span class="line">    size=数值 ：data section的容量，即可不将全部的设备容量用完</span><br><span class="line">    su=数值 ：当有磁盘阵列RAID时，分区区块stripe数值，与下面的sw搭配使用</span><br><span class="line">    sw=数值 ：当有磁盘阵列RAID时，用于储存数据的磁盘数量(须扣除备份碟与备用碟)</span><br><span class="line">    sunit=数值 ：与su相当，不过单位使用的是几个sector(512bytes大小)</span><br><span class="line">    swidth=数值 ：就是su*sw的数值，但是以几个sector(512bytes大小)来设定</span><br><span class="line">-f ：如果设备内已经有文件系统，则需要使用这个-f 来强制格式化才行</span><br><span class="line">-i ：与inode有较相关的设定，主要的设定值有：</span><br><span class="line">    size=数值 ：最小256bytes最大2k，一般保留256</span><br><span class="line">    internal=[0|1]：log装置是否为内建？预设为1内建，若要用外部装置</span><br><span class="line">    logdev=device ：log装置为后面接的那个装置上头的意思，需设定internal=0才可</span><br><span class="line">    size=数值 ：指定这块登录区的容量，通常最小512个block，大约2M以上才行</span><br><span class="line">-L ：后面接这个文件系统的标头名称Label name的意思</span><br><span class="line">-r ：指定realtime section的相关设定值，常见的有：</span><br><span class="line">    extsize=数值 ：一般不须设定，但有RAID时，最好设定与swidth的数值相同，最小为4K最大为1G</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">blkid /dev/sda6</span><br><span class="line">/dev/sda6: PARTLABEL="Linux filesystem" PARTUUID="20077c57-aa6f-4bd7-8f38-e6396a77c7a9" </span><br><span class="line"></span><br><span class="line">mkfs.xfs /dev/sda6</span><br><span class="line">Discarding blocks...Done.</span><br><span class="line">meta-data=/dev/sda6              isize=512    agcount=4, agsize=65536 blks</span><br><span class="line">         =                       sectsz=512   attr=2, projid32bit=1</span><br><span class="line">         =                       crc=1        finobt=0, sparse=0</span><br><span class="line">data     =                       bsize=4096   blocks=262144, imaxpct=25</span><br><span class="line">         =                       sunit=0      swidth=0 blks</span><br><span class="line">naming   =version 2              bsize=4096   ascii-ci=0 ftype=1</span><br><span class="line">log      =internal log           bsize=4096   blocks=2560, version=2</span><br><span class="line">         =                       sectsz=512   sunit=0 blks, lazy-count=1</span><br><span class="line">realtime =none                   extsz=4096   blocks=0, rtextents=0</span><br><span class="line"></span><br><span class="line">blkid /dev/sda6</span><br><span class="line">/dev/sda6: UUID="05052ace-d0b2-448b-9470-830545f4a581" TYPE="xfs" PARTLABEL="Linux filesystem" PARTUUID="20077c57-aa6f-4bd7-8f38-e6396a77c7a9" </span><br><span class="line"></span><br><span class="line">mkfs.xfs -f -d agcount=8 /dev/sd6</span><br></pre></td></tr></table></figure>
<p>磁盘阵列是由<strong>多个磁盘组成</strong>的一个大磁盘，不但可加快读写速度，还可在某个磁盘坏掉时保证文件系统可运行；磁盘阵列RAID是通过将文件先细分为数个小型分区区块stripe后，然后将众多分区区块stripes分别放到磁盘阵列里面的所有磁盘，所以一个文件是被同时写入到多个磁盘中去；为了保证文件安全性，会保留数个备份磁盘，以及可能会会保留一个以上的备用磁盘；</p>
<p>当CPU核心数为2时，agcount指定为2，若<strong>磁盘阵列<code>RAID</code></strong>的<strong>分区区块<code>stripe</code></strong>指定为256K，则<strong><code>su</code></strong>设定为256k，若磁盘阵列有8颗，则有一个parity备份碟，因<strong><code>sw</code></strong>设置为<strong><code>7</code></strong>，则数据宽度<strong><code>swidth</code></strong>为<strong><code>256K*7</code></strong>即<strong><code>1792K</code></strong>，可指定<strong><code>extsize</code></strong>为<strong><code>1792k</code></strong>；若想要<strong>格式化<code>ext4</code>文件系统</strong>，可使用<strong><code>mkfs.ext4</code></strong>命令：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">mkfs.ext4 [-b size] [-L label] 装置名称</span><br><span class="line">选项与参数：</span><br><span class="line">    -b ：设定 block 的大小，有 1K, 2K, 4K 的容量</span><br><span class="line">    -L ：后面接这个装置的标头名称</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 将/dev/sda6格式化为ext4文件系统</span><br><span class="line">mkfs.ext4 /dev/sda6</span><br><span class="line">mke2fs 1.42.9 (28-Dec-2013)</span><br><span class="line">Discarding device blocks: 完成                            </span><br><span class="line">文件系统标签=				# 显示 Label name</span><br><span class="line">OS type: Linux</span><br><span class="line">块大小=4096 (log=2)	# 每一个 block 的大小</span><br><span class="line">分块大小=4096 (log=2)</span><br><span class="line">Stride=0 blocks, Stripe width=0 blocks	# 跟 RAID 相关性较高</span><br><span class="line">65536 inodes, 262144 blocks		# 总计 inode/block 的数量</span><br><span class="line">13107 blocks (5.00%) reserved for the super user</span><br><span class="line">第一个数据块=0</span><br><span class="line">Maximum filesystem blocks=268435456</span><br><span class="line">8 block groups		# 共有 8 个 block groups</span><br><span class="line">32768 blocks per group, 32768 fragments per group</span><br><span class="line">8192 inodes per group</span><br><span class="line">Superblock backups stored on blocks: </span><br><span class="line">        32768, 98304, 163840, 229376</span><br><span class="line"></span><br><span class="line">Allocating group tables: 完成                            </span><br><span class="line">正在写入inode表: 完成                            </span><br><span class="line">Creating journal (8192 blocks): 完成</span><br><span class="line">Writing superblocks and filesystem accounting information: 完成</span><br></pre></td></tr></table></figure>
<p><strong><code>mkfs</code></strong>是个综合指令当使用<strong><code>mkfs -t xfs</code></strong>时，它会去找<strong><code>mkfs.xfs</code></strong>相关的参数，若想知道系统还支持哪种文件系统的格式化功能，直接按两下tab键  </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mkfs[tab][tab]</span><br><span class="line">mkfs         mkfs.btrfs   mkfs.cramfs  mkfs.ext2    mkfs.ext3    mkfs.ext4    mkfs.fat     mkfs.minix   mkfs.msdos   mkfs.vfat    mkfs.xfs</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 将/dev/sd6重新格式化为VFAT文件系统</span><br><span class="line">mkfs -t vfat /dev/sd6</span><br><span class="line"><span class="meta">#</span> 将/dev/sd6重新格式化为ext4文件系统</span><br><span class="line">mkfs.ext4 /dev/sd6</span><br></pre></td></tr></table></figure>
<p>当<strong>xfs</strong>文件系统发生异常时可使用<strong><code>xfs_repair</code></strong>命令来检查文件系统，若是<strong><code>ext4</code></strong>文件系统建议使用<strong><code>fsck.ext4</code></strong>命令来检查，当为root用户时且文件系统有问题时才使用该命令，或怀疑刚刚格式化成功的磁盘有问题时；正常状态下使用时可能会造成对系统的损害；由于<strong><code>xfs_repair</code></strong>和<strong><code>fsck.ext4</code></strong>命令扫描磁盘时可能会造成部分文件系统修正，所以执行这两个命令时被检查的分区不能挂载到系统上；</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"> xfs_repair [-fnd] 装置名称</span><br><span class="line"> 选项与参数：</span><br><span class="line">    -f ：后面的装置其实是个文件而不是实体装置</span><br><span class="line">    -n ：单纯检查并不修改文件系统的任何数据</span><br><span class="line">    -d ：通常用在单人维护模式底下，针对根目录/进行检查与修复的动作！很危险！不要随便使用</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">fsck.ext4 [-pf] [-b superblock] 装置名称</span><br><span class="line">选项与参数：</span><br><span class="line">    -p ：当文件系统在修复时，若有需要回复y的动作时，自动回复y来继续进行修复动作</span><br><span class="line">    -f ：强制检查！若fsck没有发现任何unclean的标志，不会主动进一步检查，若要强制fsck进一步检查，则加上-f参数</span><br><span class="line">    -D ：针对文件系统下的目录进行优化配置</span><br><span class="line">    -b ：后面接superblock的位置！一般用不到，但若superblock因故损毁时，通过该参数即可利用文件系统内备份的superblock来尝试修复，一般superblock备份在：1K block放在8193, 2K block放在16384, 4K block放在32768</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">dumpe2fs -h /dev/sda6 | grep 'Blocks per group'</span><br><span class="line">dumpe2fs 1.42.9 (28-Dec-2013)</span><br><span class="line">Blocks per group:         32768</span><br><span class="line"></span><br><span class="line">fsck.ext4 -b 32768 /dev/sda6</span><br><span class="line">e2fsck 1.42.9 (28-Dec-2013)</span><br><span class="line">/dev/sda6 was not cleanly unmounted, 强制检查.</span><br><span class="line">第一步: 检查inode,块,和大小</span><br><span class="line">第二步: 检查目录结构</span><br><span class="line">第3步: 检查目录连接性</span><br><span class="line">Pass 4: Checking reference counts</span><br><span class="line">第5步: 检查簇概要信息</span><br><span class="line"></span><br><span class="line">/dev/sda6: ***** 文件系统已修改 *****</span><br><span class="line">/dev/sda6: 11/65536 files (0.0% non-contiguous), 12955/262144 blocks</span><br></pre></td></tr></table></figure>
<h4 id="文件系统挂载"><a href="#文件系统挂载" class="headerlink" title="文件系统挂载"></a>文件系统挂载</h4><p><strong>挂载点</strong>是进入<strong>磁盘分区槽</strong>即<strong>文件系统</strong>的<strong>入口</strong>，<strong>单一文件系统不应该被重复挂载</strong>在不同的挂载点即目录中，<strong>单一目录不应该重复挂载</strong>多个文件系统，作为挂载点的目录，理论上应该都是空目录，若不为空挂载文件系统后，原目录内的内容将<strong>暂时消失</strong>，卸载分区槽后恢复；使用<strong><code>mount</code></strong>命令来将文件系统挂载到Linux系统上；</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">mount -a</span><br><span class="line">mount [-l]</span><br><span class="line">mount [-t 文件系统] LABEL='' 挂载点</span><br><span class="line">mount [-t 文件系统] UUID='' 挂载点 # 鸟哥近期建议用这种方式喔！</span><br><span class="line">mount [-t 文件系统] 装置文件名 挂载点</span><br><span class="line">选项与参数：</span><br><span class="line">    -a ：按照配置文件/etc/fstab的数据将所有未挂载的磁盘都挂载上来</span><br><span class="line">    -l ：单纯的输入mount会显示目前挂载的信息，加上-l可增列Label名称</span><br><span class="line">    -t ：可加上文件系统种类来指定欲挂载的类型，常见类型有：xfs,ext3,ext4,reiserfs,vfat,iso9660,nfs,cifs,smbfs</span><br><span class="line">    -n ：默认系统会将实际挂载实时写入/etc/mtab中，某些情况下为了避免问题会刻意不写入可使用-n</span><br><span class="line">    -o ：后面可以接一些挂载时额外加上的参数，如账号、密码、读写权限等：</span><br><span class="line">        async, sync: 此文件系统是否使用同步写入或异步的内存机制，预设为async</span><br><span class="line">        atime,noatime: 是否修改文件读取时间atime，为了效能某些时候可用noatime</span><br><span class="line">        ro, rw: 挂载文件系统成为只读ro或可擦写rw</span><br><span class="line">        auto, noauto: 允许此filesystem被以mount -a自动挂载</span><br><span class="line">        dev, nodev: 是否允许此filesystem上建立设备文件，dev为允许</span><br><span class="line">        suid, nosuid: 是否允许此filesystem含有suid/sgid的文件格式</span><br><span class="line">        exec, noexec: 是否允许此filesystem上拥有可执行binary文件</span><br><span class="line">        user, nouser: 是否允许此filesystem让任何使用者执行mount，一般mount仅root可进行，指定user参数可让一般user也能够对此partition进行mount</span><br><span class="line">        defaults: 默认值为：rw, suid, dev, exec, auto, nouser, async</span><br><span class="line">        remount: 重新挂载，在系统出错或重新更新参数时，很有用</span><br></pre></td></tr></table></figure>
<p>CentOS7不需要<strong><code>-t</code></strong>参数也能自动分析最恰当的文件系统来尝试挂载需要的设备，这也是blkid能正确显示文件系统的原因，Linux通过分析<strong><code>superblock</code></strong>搭配Linux的驱动程序去测试挂载，系统主要哦参考以下两个文件来进行挂载测试：</p>
<ul>
<li><strong><code>/etc/filesystems</code></strong>：系统指定的测试挂载文件系统类型的优先级</li>
<li><strong><code>/proc/filesystems</code></strong>：Linux系统已经加载的文件系统类型  </li>
</ul>
<p><strong>Linux支持的文件系统驱动程序</strong>都写在<strong><code>/lib/modules/$(uname -r)/kernel/fs/</code></strong>目录中；推荐使用UUID来识别文件系统；也可以<strong>利用<code>mount --bind</code>命令来将某个目录挂载到另外一个目录</strong>；可通过<strong><code>umount</code></strong>命令将已挂载的文件系统卸载，卸载后可使用<strong><code>df</code></strong>或<strong>mount</strong>查看是否还存在目录树中，<strong>可通过设备文件名或挂载点来卸载</strong>；  </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 该命令需要使用root用户执行，否则没有任务内容</span><br><span class="line">blkid /dev/sda6</span><br><span class="line">/dev/sda6: UUID="4f61cba1-c396-424e-8e19-b52874858c10" TYPE="ext4" PARTLABEL="Linux filesystem" PARTUUID="20077c57-aa6f-4bd7-8f38-e6396a77c7a9" </span><br><span class="line"></span><br><span class="line">mkdir -p /data1/ext4</span><br><span class="line">mount UUID="4f61cba1-c396-424e-8e19-b52874858c10" /data1/ext4</span><br><span class="line"></span><br><span class="line">df /data1/ext4/</span><br><span class="line">文件系统        1K-块  已用   可用 已用% 挂载点</span><br><span class="line">/dev/sda6      999320  2564 927944    1% /data1/ext4</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 将/data1/ext4重新挂载，并加入参数为rw、auto、sync</span><br><span class="line">mount -o remount,rw,auto,sync /data1/ext4</span><br><span class="line"><span class="meta">#</span> 将/data1/ext4/目录暂时挂载到/data2/xfs/</span><br><span class="line">mount --bind /data1/ext4/ /data2/xfs/</span><br><span class="line"><span class="meta">#</span> 将挂载的目录卸载掉</span><br><span class="line">umount /data2/xfs</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 两个文件inode相同</span><br><span class="line">ls -lid /data1/ext4/ /data2/xfs/</span><br><span class="line">203639013 drwxr-xr-x 2 root root 6 12月 26 22:19 /data1/ext4/</span><br><span class="line">203639013 drwxr-xr-x 2 root root 6 12月 26 22:19 /data2/xfs/</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 将装置文件卸除</span><br><span class="line">umount [-fn] 装置文件名或挂载点</span><br><span class="line">选项与参数：</span><br><span class="line">    -f ：强制卸除，可用在类似网络文件系统NFS无法读取到的情况下</span><br><span class="line">    -l ：立刻卸除文件系统，比-f还强</span><br><span class="line">    -n ：不更新/etc/mtab情况下卸除</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 若在当前目录下是否无法卸载的</span><br><span class="line">umount /data1/ext4</span><br></pre></td></tr></table></figure>
<p>系统挂载也有一些限制：</p>
<ul>
<li><strong>根目录必须挂载</strong>，且<strong>先于其他<code>mount print</code>被挂载</strong></li>
<li>其他mount print必须为<strong>已创建的目录</strong>，可任意指定，但一定要遵守FHS</li>
<li>所有<strong><code>mount print</code>同一时间只能被挂载一次</strong></li>
<li>所有<strong><code>partition</code>在同一时间只能挂载一次</strong></li>
<li>若<strong>卸载</strong>必须先将<strong>工作目录移到<code>mount point</code>及其子目录之外</strong> </li>
</ul>
<p>可通过修改<strong><code>/etc/fstab</code></strong>即<strong><code>filesystem table</code></strong>配置文件实现<strong>开机挂载</strong>，且就是执行<strong><code>mount</code></strong>命令进行挂载时将选项和参数写入的该文件；且<strong><code>/etc/fstab</code></strong>还加入dump备份指令和fsck文件系统校验命令</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">cat /etc/fstab </span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span> /etc/fstab</span><br><span class="line"><span class="meta">#</span> Created by anaconda on Mon Jan 24 03:25:14 2022</span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span> Accessible filesystems, by reference, are maintained under '/dev/disk'</span><br><span class="line"><span class="meta">#</span> See man pages fstab(5), findfs(8), mount(8) and/or blkid(8) for more info</span><br><span class="line"><span class="meta">#</span></span><br><span class="line">设备/UUID      					挂载点     文件系统 文件系统参数      dump  fsck</span><br><span class="line">UUID=fcb72d23-6dc8-40db-9065-590c3f8d2dbe 	/          xfs    defaults        0 	0</span><br><span class="line">UUID=f0dda9b9-4595-4c0a-b084-b7c87808f83c 	/boot      xfs    defaults        0 	0</span><br><span class="line">UUID=B99A-7DF9  				/boot/efi  vfat   umask=0077,shortname=winnt 0 	0</span><br><span class="line">UUID=673e388b-5ac9-42e0-a29d-c76bd6b0bf22 	/home      xfs    defaults        0 	0</span><br><span class="line">UUID=9dc5c38e-fbd4-48dc-ab2b-15f772fbe19f 	swap       swap   defaults        0 	0</span><br></pre></td></tr></table></figure>
<p>若将<strong><code>/dev/vda4</code></strong>每次<strong>开机都自动挂载</strong>到<strong><code>/data/xfs</code></strong>，在<strong><code>/etc/fstab</code></strong>中追加如下数据，若通过mount临时挂载，每次重启后需要重新挂载：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UUID="e0fa7252-b374-4a06-987a-3cb14f415488" /data/xfs xfs defaults 0 0</span><br></pre></td></tr></table></figure>
<p><strong><code>/etc/fstab</code></strong>是<strong>开机时的配置文件</strong>，但filesystem的挂载实际是记录到<strong><code>/etc/mtab</code></strong>与<strong><code>/proc/mounts</code></strong>中的，每次修改filesystem的挂载时会同时更新这两个文件，但万一<strong>/etc/fstab输入的数据错误</strong>导致无法开机成功，在单人维护模式中由于文件状态为ready only无法修改<strong><code>/etc/fstab</code></strong>也无法更新/etc/mtab，此时可利用<strong><code>mount -n -o remount,rw /</code></strong>命令<strong>重新挂载</strong>；使用<strong>光盘镜像文件</strong>或<strong>文件作为磁盘</strong>的方式时，不需要刻录但需要<strong><code>loop</code></strong>装置来将其挂载起来：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir /data/centos_dvd</span><br><span class="line">mount -o loop /tmp/CentOS-7.0-1406-x86_64-DVD.iso /data/centos_dvd</span><br></pre></td></tr></table></figure>
<p>也可以<strong>制作一个大文件</strong>，然后<strong>将该文件格式化后挂载</strong>，通过这种方式还能够帮助我们解决很多系统的分区不合理的情况，可通过<strong><code>dd</code></strong>命令来创建空的文件，在Linux上使用<strong><code>xen</code></strong>软件，再配合<strong><code>loop device</code></strong>的文件类型来进行根目录的挂载：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 建立一个512M大小的空文件在/srv/loopdev</span><br><span class="line"><span class="meta">#</span> if是input file输入文件/dev/zero会一直输出0的装置</span><br><span class="line"><span class="meta">#</span> of是output file将一堆零写入到后面接的文件中</span><br><span class="line"><span class="meta">#</span> bs是每个block大小，就像文件系统那样的block 意义</span><br><span class="line"><span class="meta">#</span> count则是总共几个bs的意思。所以bs*count就是这个文件的容量</span><br><span class="line">dd if=/dev/zero of=/srv/loopdev bs=1M count=512</span><br><span class="line"><span class="meta">#</span> 大型文件的格式化</span><br><span class="line">mkfs.xfs -f /srv/loopdev </span><br><span class="line">blkid /srv/loopdev</span><br><span class="line">/srv/loopdev: UUID="4364721c-d693-458f-964d-fb0799a1972e" TYPE="xfs" </span><br><span class="line"><span class="meta">#</span> 通过mount命令挂载</span><br><span class="line">mount -o loop UUID="4364721c-d693-458f-964d-fb0799a1972e" /mnt</span><br><span class="line"></span><br><span class="line">df /mnt</span><br><span class="line">文件系统        1K-块  已用   可用 已用% 挂载点</span><br><span class="line">/dev/loop0     520868 26436 494432    6% /mnt</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 在/etc/fstab文件中添加如下内容</span><br><span class="line">/srv/loopdev /data/file xfs defaults,loop 0 0</span><br><span class="line"></span><br><span class="line">mkdir /data/file</span><br><span class="line">mount -a</span><br><span class="line">df /data/file</span><br></pre></td></tr></table></figure>
<h4 id="swap"><a href="#swap" class="headerlink" title="swap"></a>swap</h4><p>早期在安装Linux时一定需要的<strong>两个<code>partition</code></strong>一个是<strong>根目录</strong>，另外一个就是<strong><code>swap</code>内存置换空间</strong>，若硬件的配备资源足够swap不会被系统所使用，<strong>物理内存不足</strong>时才会使用<strong><code>swap</code></strong>；CPU所读取的数据都来自于内存，当内存不足时为了让后续程序正常运行，因此在<strong>内存中暂不使用的程序</strong>与<strong>数据</strong>会被<strong>挪到<code>swap</code></strong>中，此时内存就会空出来给需要执行的程序加载；由于swap是用磁盘来暂时放置内存中的信息，故用到swap时主机磁盘灯会开始闪个不停；</p>
<p>个人用可以不设定swap，但若支持电源管理模式即Linux主机系统可以进入<strong>休眠模式</strong>的话，运行中的程序状态会被纪录到swap中作为<strong>唤醒</strong>主机的状态依据，若是<strong>服务器</strong>的话由于<strong>不知道何时会有大量网络请求</strong>，<strong>最好预留swap来缓冲系统内存用量</strong>；若系统已经建立完成，但发现没有创建swap分区，可先设定一个swap分区，在创建一个虚拟内存文件；</p>
<ul>
<li>分区：先<strong>使用<code>gdisk</code>在磁盘中分区出一个分区槽</strong>给系统作为swap</li>
<li>格式化：利用建立swap格式的<strong><code>mkswap</code> 设备文件名</strong>就能够格式化该分区槽成为swap格式</li>
<li>使用：最后将该swap设备启动，即执行<strong><code>swapon</code> 设备文件名</strong>命令</li>
<li>观察：最终透过<strong><code>free</code></strong>与<strong><code>swapon -s</code></strong>指令<strong>来观察内存的使用情况</strong>  </li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 步骤一：分区</span><br><span class="line">gdisk /dev/sda</span><br><span class="line">GPT fdisk (gdisk) version 0.8.10</span><br><span class="line"></span><br><span class="line">Partition table scan:</span><br><span class="line">  MBR: protective</span><br><span class="line">  BSD: not present</span><br><span class="line">  APM: not present</span><br><span class="line">  GPT: present</span><br><span class="line"></span><br><span class="line">Found valid GPT with protective MBR; using GPT.</span><br><span class="line"></span><br><span class="line">Command (? for help): n</span><br><span class="line">Partition number (7-128, default 7): </span><br><span class="line">First sector (34-488397134, default = 468690944) or &#123;+-&#125;size&#123;KMGTP&#125;: </span><br><span class="line">Last sector (468690944-488397134, default = 488397134) or &#123;+-&#125;size&#123;KMGTP&#125;: +512M</span><br><span class="line">Current type is 'Linux filesystem'</span><br><span class="line">Hex code or GUID (L to show codes, Enter = 8300): 8200</span><br><span class="line">Changed type of partition to 'Linux swap'</span><br><span class="line"></span><br><span class="line">Command (? for help): p</span><br><span class="line">Disk /dev/sda: 488397168 sectors, 232.9 GiB</span><br><span class="line">Logical sector size: 512 bytes</span><br><span class="line">Disk identifier (GUID): 7B10AC68-EEE7-42BC-9088-3BB71109903A</span><br><span class="line">Partition table holds up to 128 entries</span><br><span class="line">First usable sector is 34, last usable sector is 488397134</span><br><span class="line">Partitions will be aligned on 2048-sector boundaries</span><br><span class="line">Total free space is 18659629 sectors (8.9 GiB)</span><br><span class="line"></span><br><span class="line">Number  Start (sector)    End (sector)  Size       Code  Name</span><br><span class="line">   1            2048          976895   476.0 MiB   EF00  EFI System Partition</span><br><span class="line">   2          976896         2928639   953.0 MiB   0700  </span><br><span class="line">   3         2928640       298627071   141.0 GiB   0700  </span><br><span class="line">   4       298627072       454875135   74.5 GiB    0700  </span><br><span class="line">   5       454875136       466593791   5.6 GiB     8200  </span><br><span class="line">   6       466593792       468690943   1024.0 MiB  8300  Linux filesystem</span><br><span class="line">   7       468690944       469739519   512.0 MiB   8200  Linux swap</span><br><span class="line"></span><br><span class="line">Command (? for help): w</span><br><span class="line"></span><br><span class="line">Final checks complete. About to write GPT data. THIS WILL OVERWRITE EXISTING</span><br><span class="line">PARTITIONS!!</span><br><span class="line"></span><br><span class="line">Do you want to proceed? (Y/N): y</span><br><span class="line">OK; writing new GUID partition table (GPT) to /dev/sda.</span><br><span class="line">Warning: The kernel is still using the old partition table.</span><br><span class="line">The new table will be used at the next reboot.</span><br><span class="line">The operation has completed successfully.</span><br><span class="line"></span><br><span class="line">partprobe</span><br><span class="line"></span><br><span class="line">lsblk</span><br><span class="line">NAME   MAJ:MIN RM   SIZE RO TYPE MOUNTPOINT</span><br><span class="line">sda      8:0    0 232.9G  0 disk </span><br><span class="line">├─sda1   8:1    0   476M  0 part /boot/efi</span><br><span class="line">├─sda2   8:2    0   953M  0 part /boot</span><br><span class="line">├─sda3   8:3    0   141G  0 part /home</span><br><span class="line">├─sda4   8:4    0  74.5G  0 part /</span><br><span class="line">├─sda5   8:5    0   5.6G  0 part </span><br><span class="line">├─sda6   8:6    0     1G  0 part </span><br><span class="line">└─sda7   8:7    0   512M  0 part </span><br><span class="line">loop0    7:0    0   512M  0 loop /data/file</span><br><span class="line"><span class="meta">#</span> 步骤二：创建swap格式</span><br><span class="line">mkswap /dev/sda7</span><br><span class="line">正在设置交换空间版本 1，大小 = 524284 KiB</span><br><span class="line">无标签，UUID=d9ac2104-0e8c-426b-8fa2-3cfa7277b4a7</span><br><span class="line"></span><br><span class="line">blkid /dev/sda7</span><br><span class="line">/dev/sda7: UUID="d9ac2104-0e8c-426b-8fa2-3cfa7277b4a7" TYPE="swap" PARTLABEL="Linux swap" PARTUUID="2c266025-b487-4e20-b60e-9ee1d81a3ae6" </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 观察</span><br><span class="line">free</span><br><span class="line">              total        used        free      shared  buff/cache   available</span><br><span class="line">Mem:       16137536      491500    15025276       17268      620760    15359456</span><br><span class="line">Swap:             0           0           0</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span>步骤三：启动</span><br><span class="line">swapon /dev/sda7</span><br><span class="line"></span><br><span class="line">free</span><br><span class="line">              total        used        free      shared  buff/cache   available</span><br><span class="line">Mem:       16137536      492168    15024356       17268      621012    15358784</span><br><span class="line">Swap:        524284           0      524284</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 步骤四：观察</span><br><span class="line">swapon -s</span><br><span class="line">文件名                          类型            大小    已用    权限</span><br><span class="line">/dev/sda7                               partition       524284  0       -2</span><br></pre></td></tr></table></figure>
<p>若实体分区槽无法支持的情况下，可使用创建一个大文件<strong><code>loop</code></strong>的方式创建swap，可通过<strong><code>swapoff</code></strong>命令卸载swap分区槽：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 使用dd命令在/tmp下新增一个128MB的文件</span><br><span class="line">dd if=/dev/zero of=/tmp/swap bs=1M count=128</span><br><span class="line"><span class="meta">#</span> 使用mkswap将/tmp/swap这个文件格式化为swap的文件格式</span><br><span class="line">mkswap /tmp/swap</span><br><span class="line"><span class="meta">#</span> 使用swapon来将/tmp/swap启动</span><br><span class="line">swapon /tmp/swap</span><br><span class="line"><span class="meta">#</span> 使用swapoff关掉swap file并设定自动启用</span><br><span class="line">nano /etc/fstab</span><br><span class="line">/tmp/swap swap swap defaults 0 0</span><br><span class="line"></span><br><span class="line">swapoff /tmp/swap /dev/vda6</span><br><span class="line">swapon -a</span><br><span class="line">swapon -s</span><br></pre></td></tr></table></figure>
<p>整个文件系统中包括superblock, inode table与其他数据等其实都会浪费磁盘容量，当在/dev/sda6和/dev/sda7建立起<strong><code>xfs/ext4</code></strong>文件系统时，一挂载就立刻有很多容量被用掉了；使用<strong><code>ls -l</code></strong>去查询某个目录下的数据时，第一行会出现一个total的字样，即该目录下的所有数据所耗用的实际block数量乘以block大小的值，etc目录虽然仅有8K但其消耗的内存总量确是12K；  </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">ll -sh</span><br><span class="line">总用量 32K</span><br><span class="line">   0 lrwxrwxrwx.   1 root root    7 1月  24 2022 bin -&gt; usr/bin</span><br><span class="line">4.0K dr-xr-xr-x.   5 root root 4.0K 1月   1 20:38 boot</span><br><span class="line">4.0K drwxr-xr-x.  20 root root 4.0K 1月   1 20:38 data</span><br><span class="line">   0 drwxr-xr-x    3 root root   18 12月 26 22:19 data1</span><br><span class="line">   0 drwxr-xr-x    3 root root   17 12月 26 22:26 data2</span><br><span class="line">   0 drwxr-xr-x   19 root root 3.3K 1月   1 21:00 dev</span><br><span class="line"> 12K drwxr-xr-x. 149 root root 8.0K 1月   1 20:42 etc</span><br><span class="line">   0 drwxr-xr-x.   5 root root   50 7月  31 2022 home</span><br><span class="line">   0 lrwxrwxrwx.   1 root root    7 1月  24 2022 lib -&gt; usr/lib</span><br><span class="line">   0 lrwxrwxrwx.   1 root root    9 1月  24 2022 lib64 -&gt; usr/lib64</span><br><span class="line">   0 drwxr-xr-x.   2 root root    6 4月  11 2018 media</span><br><span class="line">   0 drwxr-xr-x.   2 root root    6 4月  11 2018 mnt</span><br><span class="line">   0 drwxr-xr-x.   6 root root   59 8月   6 2022 opt</span><br><span class="line">   0 dr-xr-xr-x  214 root root    0 1月   2 2024 proc</span><br><span class="line">4.0K dr-xr-x---.  12 root root 4.0K 1月   1 20:37 root</span><br><span class="line">   0 drwxr-xr-x   41 root root 1.3K 1月   1 21:16 run</span><br><span class="line">   0 lrwxrwxrwx.   1 root root    8 1月  24 2022 sbin -&gt; usr/sbin</span><br><span class="line">   0 drwxr-xr-x.   2 root root   21 1月   1 20:17 srv</span><br><span class="line">   0 dr-xr-xr-x   13 root root    0 1月   2 2024 sys</span><br><span class="line">4.0K drwxrwxrwt.  12 root root 4.0K 1月   1 20:58 tmp</span><br><span class="line">   0 drwxr-xr-x.  13 root root  155 1月  24 2022 usr</span><br><span class="line">4.0K drwxr-xr-x.  21 root root 4.0K 1月  23 2022 var</span><br></pre></td></tr></table></figure>

        </div>
        
    <footer class="article-footer">
    </footer>
    </div>
</article>


    
    <nav id="article-nav">
        
            <a href="/Blog/Java/VM/Class文件结构/" id="article-nav-newer" class="article-nav-link-wrap">
                <strong class="article-nav-caption">Newer</strong>
                <div class="article-nav-title">
                    
                        Class文件结构
                    
                </div>
            </a>
        
        
            <a href="/Blog/Java/VM/内存非配与回收策略/" id="article-nav-older" class="article-nav-link-wrap">
                <strong class="article-nav-caption">Older</strong>
                <div class="article-nav-title">内存分配与回收策略</div>
            </a>
        
    </nav>





    
    




    <!-- baidu url auto push script -->
    <script type="text/javascript">
        !function () {
            var e = /([http|https]:\/\/[a-zA-Z0-9\_\.]+\.baidu\.com)/gi, r = window.location.href,
                o = document.referrer;
            if (!e.test(r)) {
                var n = "//api.share.baidu.com/s.gif";
                o ? (n += "?r=" + encodeURIComponent(document.referrer), r && (n += "&l=" + r)) : r && (n += "?l=" + r);
                var t = new Image;
                t.src = n
            }
        }(window);
    </script>
</section>
    </div>
    <footer id="footer">
    <div class="outer">
        <div id="footer-info" class="inner">
            YaoYingLong &copy; 2024
            <!-- <a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-nd/4.0/80x15.png" /></a> -->
            <br> Powered by <a href="http://hexo.io/" target="_blank" rel="external nofollow noopener noreferrer">Hexo</a>. Theme - <a href="https://github.com/zthxxx/hexo-theme-Wikitten" rel="external nofollow noopener noreferrer" target="_blank">wikitten</a>
        </div>
    </div>
</footer>
    

    
        <script src="/libs/lightgallery/js/lightgallery.min.js"></script>
        <script src="/libs/lightgallery/js/lg-thumbnail.min.js"></script>
        <script src="/libs/lightgallery/js/lg-pager.min.js"></script>
        <script src="/libs/lightgallery/js/lg-autoplay.min.js"></script>
        <script src="/libs/lightgallery/js/lg-fullscreen.min.js"></script>
        <script src="/libs/lightgallery/js/lg-zoom.min.js"></script>
        <script src="/libs/lightgallery/js/lg-hash.min.js"></script>
        <script src="/libs/lightgallery/js/lg-share.min.js"></script>
        <script src="/libs/lightgallery/js/lg-video.min.js"></script>
    
    
        <script src="/libs/justified-gallery/jquery.justifiedGallery.min.js"></script>
    
    
        <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true,
            TeX: {
                equationNumbers: {
                  autoNumber: 'AMS'
                }
            }
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });


</script>
<script async src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    



<!-- Custom Scripts -->
<script src="/js/main.js"></script>

</div>
</body>
